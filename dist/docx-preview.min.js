!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jszip"),require("lodash-es"),require("konva")):"function"==typeof define&&define.amd?define(["exports","jszip","lodash-es","konva"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).docx={},e.JSZip,e._,e.Konva)}(this,function(e,t,r,n){"use strict";function a(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var s=a(r);function i(e,t,r,n){return new(r||(r=Promise))(function(a,s){function i(e){try{o(n.next(e))}catch(e){s(e)}}function l(e){try{o(n.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,l)}o((n=n.apply(e,t||[])).next())})}function l(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}"function"==typeof SuppressedError&&SuppressedError;const o={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4","mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["*mp4","mp4v","*mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};var c,d,p;Object.freeze(o);c=new WeakMap,d=new WeakMap,p=new WeakMap;var h,u=new class{constructor(...e){c.set(this,new Map),d.set(this,new Map),p.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[r,n]of Object.entries(e)){r=r.toLowerCase(),n=n.map(e=>e.toLowerCase()),l(this,p,"f").has(r)||l(this,p,"f").set(r,new Set);const e=l(this,p,"f").get(r);let a=!0;for(let s of n){const n=s.startsWith("*");if(s=n?s.slice(1):s,null==e||e.add(s),a&&l(this,d,"f").set(r,s),a=!1,n)continue;const i=l(this,c,"f").get(s);if(i&&i!=r&&!t)throw new Error(`"${r} -> ${s}" conflicts with "${i} -> ${s}". Pass \`force=true\` to override this definition.`);l(this,c,"f").set(s,r)}}return this}getType(e){var t;if("string"!=typeof e)return null;const r=e.replace(/^.*[/\\]/,"").toLowerCase(),n=r.replace(/^.*\./,"").toLowerCase(),a=r.length<e.length;return!(n.length<r.length-1)&&a?null:null!==(t=l(this,c,"f").get(n))&&void 0!==t?t:null}getExtension(e){var t,r;return"string"!=typeof e?null:null!==(r=(e=null===(t=null==e?void 0:e.split)||void 0===t?void 0:t.call(e,";")[0])&&l(this,d,"f").get(e.trim().toLowerCase()))&&void 0!==r?r:null}getAllExtensions(e){var t;return"string"!=typeof e?null:null!==(t=l(this,p,"f").get(e.toLowerCase()))&&void 0!==t?t:null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of l(this,p,"f").values())Object.freeze(e);return this}_getTestState(){return{types:l(this,c,"f"),extensions:l(this,d,"f")}}}(o)._freeze();!function(e){e.OfficeDocument="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",e.FontTable="http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable",e.Image="http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",e.Numbering="http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering",e.Styles="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",e.StylesWithEffects="http://schemas.microsoft.com/office/2007/relationships/stylesWithEffects",e.Theme="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",e.Settings="http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings",e.WebSettings="http://schemas.openxmlformats.org/officeDocument/2006/relationships/webSettings",e.Hyperlink="http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",e.Footnotes="http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes",e.Endnotes="http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes",e.Footer="http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer",e.Header="http://schemas.openxmlformats.org/officeDocument/2006/relationships/header",e.ExtendedProperties="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",e.CoreProperties="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",e.CustomProperties="http://schemas.openxmlformats.org/package/2006/relationships/metadata/custom-properties",e.Comments="http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments"}(h||(h={}));const m="http://schemas.openxmlformats.org/wordprocessingml/2006/main",f={mul:1/9525,unit:"px"},g={mul:.05,unit:"pt"},b={mul:1/12700,unit:"pt"},y={mul:.5,unit:"pt"},v={mul:.125,unit:"pt"},k={mul:1,unit:"pt"},x={mul:1e-5,unit:""},w={mul:.02,unit:"%"},S={mul:1e-5,unit:""},C={mul:1/6e4,unit:"deg"};function P(e,t=g,r=!0){if(!e)return null;if("number"==typeof e){let n=e*t.mul;return r?`${n.toFixed(2)}${t.unit}`:n}if(/.+(p[xt]|%)$/.test(e))return e;let n=parseFloat(e)*t.mul;return r?`${n.toFixed(2)}${t.unit}`:n}function N(e,t,r){if(e.namespaceURI!=m)return!1;switch(e.localName){case"color":t.color=r.attr(e,"val");break;case"sz":t.fontSize=r.lengthAttr(e,"val",y);break;default:return!1}return!0}class T{elements(e,t=null){const r=[];for(let n=0,a=e.childNodes.length;n<a;n++){let a=e.childNodes.item(n);1!=a.nodeType||null!=t&&a.localName!=t||r.push(a)}return r}element(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes.item(r);if(1==n.nodeType&&n.localName==t)return n}return null}elementAttr(e,t,r){let n=this.element(e,t);return n?this.attr(n,r):void 0}attrs(e){return Array.from(e.attributes)}attr(e,t,r=null){let n=this.attrs(e).find(e=>e.localName==t);return n?n.value:r}intAttr(e,t,r=null){let n=this.attr(e,t);return n?parseInt(n):r}hexAttr(e,t,r=null){let n=this.attr(e,t);return n?parseInt(n,16):r}floatAttr(e,t,r=null){let n=this.attr(e,t);return n?parseFloat(n):r}boolAttr(e,t,r=null){return function(e,t=!1){switch(e){case"1":case"on":case"true":return!0;case"0":case"off":case"false":return!1;default:return t}}(this.attr(e,t),r)}lengthAttr(e,t,r=g,n){var a;return null!==(a=P(this.attr(e,t),r))&&void 0!==a?a:n}numberAttr(e,t,r=g,n=0){var a;return null!==(a=P(this.attr(e,t),r,!1))&&void 0!==a?a:n}}const M=new T;class A{constructor(e,t){this._package=e,this.path=t}load(){return i(this,void 0,void 0,function*(){this.rels=yield this._package.loadRelationships(this.path);const e=yield this._package.load(this.path),t=this._package.parseXmlDocument(e);this._package.options.keepOrigin&&(this._xmlDocument=t),this.parseXml(t.firstElementChild)})}save(){var e;this._package.update(this.path,(e=this._xmlDocument,(new XMLSerializer).serializeToString(e)))}parseXml(e){}}const E={embedRegular:"regular",embedBold:"bold",embedItalic:"italic",embedBoldItalic:"boldItalic"};function R(e,t){return t.elements(e).map(e=>function(e,t){let r={name:t.attr(e,"name"),embedFontRefs:[]};for(let n of t.elements(e))switch(n.localName){case"family":r.family=t.attr(n,"val");break;case"altName":r.altName=t.attr(n,"val");break;case"embedRegular":case"embedBold":case"embedItalic":case"embedBoldItalic":r.embedFontRefs.push($(n,t))}return r}(e,t))}function $(e,t){return{id:t.attr(e,"id"),key:t.attr(e,"fontKey"),type:E[e.localName]}}class D extends A{parseXml(e){this.fonts=R(e,this._package.xmlParser)}}function F(e){if(void 0===e)throw new Error("className cannot be undefined. Please provide a valid string.");const t=[{pattern:/[ .]+/g,replacement:"-"},{pattern:/[&]+/g,replacement:"and"},{pattern:/[#@]+/g,replacement:""}];let r=e;for(const e of t)r=r.replace(e.pattern,e.replacement);return r.toLowerCase()}function B(e){let t=e.lastIndexOf("/")+1;return[0==t?"":e.substring(0,t),0==t?e:e.substring(t)]}function j(e,t){try{const r="http://docx/";return new URL(e,r+t).toString().substring(r.length)}catch(r){return`${t}${e}`}}function L(e){return Array.isArray(e)?e:[e]}function O(){if("object"==typeof crypto){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();if("function"==typeof crypto.getRandomValues&&"function"==typeof Uint8Array){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>{const t=Number(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})}}let e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===r?n:3&n|8).toString(16)})}class I{constructor(e,t){this._zip=e,this.options=t,this.xmlParser=new T}get(e){var t;const r=function(e){return e.startsWith("/")?e.substr(1):e}(e);return null!==(t=this._zip.files[r])&&void 0!==t?t:this._zip.files[r.replace(/\//g,"\\")]}update(e,t){this._zip.file(e,t)}static load(e,r){return i(this,void 0,void 0,function*(){const n=yield t.loadAsync(e);return new I(n,r)})}save(e="blob"){return this._zip.generateAsync({type:e})}load(e,t="string"){var r,n;return null!==(n=null===(r=this.get(e))||void 0===r?void 0:r.async(t))&&void 0!==n?n:Promise.resolve(null)}loadRelationships(){return i(this,arguments,void 0,function*(e=null){let t="_rels/.rels";if(null!=e){const[r,n]=B(e);t=`${r}_rels/${n}.rels`}const r=yield this.load(t);return r?(n=this.parseXmlDocument(r).firstElementChild,(a=this.xmlParser).elements(n).map(e=>({id:a.attr(e,"Id"),type:a.attr(e,"Type"),target:a.attr(e,"Target"),targetMode:a.attr(e,"TargetMode")}))):null;var n,a})}parseXmlDocument(e){return function(e,t=!1){var r;t&&(e=e.replace(/<[?].*[?]>/,"")),e=65279===(r=e).charCodeAt(0)?r.substring(1):r;const n=(new DOMParser).parseFromString(e,"application/xml"),a=null===(s=n.getElementsByTagName("parsererror")[0])||void 0===s?void 0:s.textContent;var s;if(a)throw new Error(a);return n}(e,this.options.trimXmlDeclaration)}}class H extends A{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.body=this._documentParser.parseDocumentFile(e)}}function _(e,t){return{type:t.attr(e,"val"),color:t.attr(e,"color"),size:t.lengthAttr(e,"sz",v),offset:t.lengthAttr(e,"space",k),frame:t.boolAttr(e,"frame"),shadow:t.boolAttr(e,"shadow")}}function z(e,t){var r={};for(let n of t.elements(e))switch(n.localName){case"left":r.left=_(n,t);break;case"top":r.top=_(n,t);break;case"right":r.right=_(n,t);break;case"bottom":r.bottom=_(n,t)}return r}var U,V,W,X,G,q,K;function J(e,t=M){var r,n;let a={contentSize:{}},s={};for(let i of t.elements(e))switch(i.localName){case"bidi":case"endnotePr":case"footnotePr":case"formProt":case"lnNumType":case"noEndnote":case"paperSrc":case"printerSettings":case"rtlGutter":case"sectPrChange":case"textDirection":case"vAlign":break;case"cols":a.columns=Y(i,t);break;case"docGrid":a.docGrid=Q(i,t);break;case"footerReference":(null!==(r=a.footerRefs)&&void 0!==r?r:a.footerRefs=[]).push(Z(i,t));break;case"headerReference":(null!==(n=a.headerRefs)&&void 0!==n?n:a.headerRefs=[]).push(Z(i,t));break;case"pgBorders":a.pageBorders=z(i,t);break;case"pgMar":a.pageMargins={left:t.lengthAttr(i,"left"),right:t.lengthAttr(i,"right"),top:t.lengthAttr(i,"top"),bottom:t.lengthAttr(i,"bottom"),header:t.lengthAttr(i,"header"),footer:t.lengthAttr(i,"footer"),gutter:t.lengthAttr(i,"gutter")},s.pageMargins={left:t.intAttr(i,"left"),right:t.intAttr(i,"right"),top:t.intAttr(i,"top"),bottom:t.intAttr(i,"bottom"),header:t.intAttr(i,"header"),footer:t.intAttr(i,"footer"),gutter:t.intAttr(i,"gutter")};break;case"pgNumType":a.pageNumber=ee(i,t);break;case"pgSz":a.pageSize={width:t.lengthAttr(i,"w"),height:t.lengthAttr(i,"h"),orientation:t.attr(i,"orient")},s.pageSize={width:t.intAttr(i,"w"),height:t.intAttr(i,"h")};break;case"titlePg":a.titlePage=t.boolAttr(i,"val",!0);break;case"type":a.type=t.attr(i,"val");break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Section Property：${e.localName}`,"color:#f75607")}let{width:i,height:l}=s.pageSize,{left:o,right:c,top:d,bottom:p}=s.pageMargins;return a.contentSize.width=P(i-o-c),a}function Y(e,t){return{count:t.intAttr(e,"num"),space:t.lengthAttr(e,"space"),separator:t.boolAttr(e,"sep"),equalWidth:t.boolAttr(e,"equalWidth",!0),columns:t.elements(e,"col").map(e=>({width:t.lengthAttr(e,"w"),space:t.lengthAttr(e,"space")}))}}function Z(e,t){return{id:t.attr(e,"id"),type:t.attr(e,"type")}}function Q(e,t){let r={type:V.Default};for(let n of t.attrs(e))switch(n.localName){case"charSpace":r.characterSpace=t.intAttr(e,"charSpace");break;case"linePitch":r.linePitch=t.intAttr(e,"linePitch");break;case"type":r.type=t.attr(e,"type",V.Default);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Grid Property：${e.localName}`,"color:#f75607")}return r}function ee(e,t){return{chapSep:t.attr(e,"chapSep"),chapStyle:t.attr(e,"chapStyle"),format:t.attr(e,"fmt"),start:t.intAttr(e,"start")}}function te(e,t){let{snapToGrid:r,spacing:n}=e,a={};if(n){let e;for(const t in n)switch(t){case"line":e=null==n?void 0:n.line;break;case"after":a["margin-bottom"]=n[t];break;case"before":a["margin-top"]=n[t]}switch(null==n?void 0:n.lineRule){case"auto":default:a["line-height"]=e/240;break;case"atLeast":a["line-height"]=`calc(100% + ${e/20}pt)`;break;case"exact":a["line-height"]=e/20+"pt"}}if(!1===r)return a;if(null==t?void 0:t.docGrid){let{docGrid:e}=t;switch(e.type){case V.Lines:case V.LinesAndChars:case V.SnapToChars:"number"==typeof a["line-height"]&&(a["line-height"]=a["line-height"]*e.linePitch/20+"pt");break;case V.Default:return a;default:console.warn(`DOCX:%c Unknown DocGrid Type：${e.type}`,"color:#f75607")}}return a}function re(e,t){let r={};for(let n of t.elements(e))ne(n,r,t);return r}function ne(e,t,r){return N(e,t,r)}function ae(e,t){let r={};for(let n of t.elements(e))se(n,r,t);return r}function se(e,t,r){if(e.namespaceURI!=m)return!1;if(N(e,t,r))return!0;switch(e.localName){case"adjustRightInd":case"autoSpaceDE":case"autoSpaceDN":case"contextualSpacing":case"divId":break;case"keepLines":t.keepLines=r.boolAttr(e,"val",!0);break;case"keepNext":t.keepNext=r.boolAttr(e,"val",!0);break;case"numPr":t.numbering=function(e,t){let r={};for(let n of t.elements(e))switch(n.localName){case"numId":r.id=t.attr(n,"val");break;case"ilvl":r.level=t.intAttr(n,"val")}return r}(e,r);break;case"outlineLvl":t.outlineLevel=r.intAttr(e,"val");break;case"pageBreakBefore":t.pageBreakBefore=r.boolAttr(e,"val",!0);break;case"rPr":t.runProperties=re(e,r);break;case"sectPr":t.sectionProperties=J(e,r);break;case"snapToGrid":t.snapToGrid=r.boolAttr(e,"val",!0);break;case"spacing":return t.spacing=function(e,t){let r={lineRule:W.Auto};for(const n of t.attrs(e))switch(n.localName){case"after":r.after=t.lengthAttr(e,"after",void 0,"0pt");break;case"afterAutospacing":case"afterLines":case"beforeAutospacing":case"beforeLines":break;case"before":r.before=t.lengthAttr(e,"before",void 0,"0pt");break;case"line":r.line=t.intAttr(e,"line",0);break;case"lineRule":r.lineRule=t.attr(e,"lineRule",W.Auto);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Spacing Property：${n.localName}`,"color:#f75607")}return r}(e,r),!1;case"tabs":t.tabs=function(e,t){return t.elements(e,"tab").map(e=>({position:t.numberAttr(e,"pos"),leader:t.attr(e,"leader"),style:t.attr(e,"val")}))}(e,r);break;case"textAlignment":return t.textAlignment=r.attr(e,"val"),!1;default:return!1}return!0}function ie(e,t){let r={id:t.attr(e,"numId"),overrides:[]};for(let n of t.elements(e))switch(n.localName){case"abstractNumId":r.abstractId=t.attr(n,"val");break;case"lvlOverride":r.overrides.push(ce(n,t))}return r}function le(e,t){let r={id:t.attr(e,"abstractNumId"),levels:[]};for(let n of t.elements(e))switch(n.localName){case"name":r.name=t.attr(n,"val");break;case"multiLevelType":r.multiLevelType=t.attr(n,"val");break;case"numStyleLink":r.numberingStyleLink=t.attr(n,"val");break;case"styleLink":r.styleLink=t.attr(n,"val");break;case"lvl":r.levels.push(oe(n,t))}return r}function oe(e,t){let r={level:t.intAttr(e,"ilvl")};for(let n of t.elements(e))switch(n.localName){case"start":r.start=t.attr(n,"val");break;case"lvlRestart":r.restart=t.intAttr(n,"val");break;case"numFmt":r.format=t.attr(n,"val");break;case"lvlText":r.text=t.attr(n,"val");break;case"lvlJc":r.justification=t.attr(n,"val");break;case"lvlPicBulletId":r.bulletPictureId=t.attr(n,"val");break;case"pStyle":r.paragraphStyle=t.attr(n,"val");break;case"pPr":r.paragraphProps=ae(n,t);break;case"rPr":r.runProps=re(n,t)}return r}function ce(e,t){let r={level:t.intAttr(e,"ilvl")};for(let n of t.elements(e))switch(n.localName){case"startOverride":r.start=t.intAttr(n,"val");break;case"lvl":r.numberingLevel=oe(n,t)}return r}function de(e,t){var r=t.element(e,"pict"),n=r&&t.element(r,"shape"),a=n&&t.element(n,"imagedata");return a?{id:t.attr(e,"numPicBulletId"),referenceId:t.attr(a,"id"),style:t.attr(n,"style")}:null}!function(e){e.Continuous="continuous",e.NextPage="nextPage",e.NextColumn="nextColumn",e.EvenPage="evenPage",e.OddPage="oddPage"}(U||(U={})),function(e){e.Default="default",e.Lines="lines",e.LinesAndChars="linesAndChars",e.SnapToChars="snapToChars"}(V||(V={})),function(e){e.AtLeast="atLeast",e.Auto="auto",e.Exact="exact"}(W||(W={}));class pe extends A{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){Object.assign(this,function(e,t){let r={numberings:[],abstractNumberings:[],bulletPictures:[]};for(let n of t.elements(e))switch(n.localName){case"num":r.numberings.push(ie(n,t));break;case"abstractNum":r.abstractNumberings.push(le(n,t));break;case"numPicBullet":r.bulletPictures.push(de(n,t))}return r}(e,this._package.xmlParser)),this.domNumberings=this._documentParser.parseNumberingFile(e)}}class he extends A{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.styles=this._documentParser.parseStylesFile(e)}}!function(e){e.Document="document",e.Page="page",e.Paragraph="paragraph",e.Run="run",e.Break="break",e.LastRenderedPageBreak="lastRenderedPageBreak",e.SectionBreak="sectionBreak",e.NoBreakHyphen="noBreakHyphen",e.Table="table",e.Row="row",e.Cell="cell",e.Hyperlink="hyperlink",e.SmartTag="smartTag",e.Drawing="drawing",e.Image="image",e.Text="text",e.Character="character",e.Tab="tab",e.Symbol="symbol",e.BookmarkStart="bookmarkStart",e.BookmarkEnd="bookmarkEnd",e.Footer="footer",e.Header="header",e.FootnoteReference="footnoteReference",e.EndnoteReference="endnoteReference",e.Footnotes="footnotes",e.Footnote="footnote",e.Endnotes="endnotes",e.Endnote="endnote",e.SimpleField="simpleField",e.ComplexField="complexField",e.Instruction="instruction",e.VmlPicture="vmlPicture",e.Shape="shape",e.MmlMath="mmlMath",e.MmlMathParagraph="mmlMathParagraph",e.MmlFraction="mmlFraction",e.MmlFunction="mmlFunction",e.MmlFunctionName="mmlFunctionName",e.MmlNumerator="mmlNumerator",e.MmlDenominator="mmlDenominator",e.MmlRadical="mmlRadical",e.MmlBase="mmlBase",e.MmlDegree="mmlDegree",e.MmlSuperscript="mmlSuperscript",e.MmlSubscript="mmlSubscript",e.MmlPreSubSuper="mmlPreSubSuper",e.MmlSubArgument="mmlSubArgument",e.MmlSuperArgument="mmlSuperArgument",e.MmlNary="mmlNary",e.MmlDelimiter="mmlDelimiter",e.MmlRun="mmlRun",e.MmlEquationArray="mmlEquationArray",e.MmlLimit="mmlLimit",e.MmlLimitLower="mmlLimitLower",e.MmlMatrix="mmlMatrix",e.MmlMatrixRow="mmlMatrixRow",e.MmlBox="mmlBox",e.MmlBar="mmlBar",e.MmlGroupChar="mmlGroupChar",e.VmlElement="vmlElement",e.Inserted="inserted",e.Deleted="deleted",e.DeletedText="deletedText",e.Comment="comment",e.CommentReference="commentReference",e.CommentRangeStart="commentRangeStart",e.CommentRangeEnd="commentRangeEnd",e.AltChunk="altChunk"}(X||(X={})),function(e){e.Base="mmlBase",e.Bar="mmlBar",e.Box="mmlBox",e.Delimiter="mmlDelimiter",e.Degree="mmlDegree",e.Denominator="mmlDenominator",e.Function="mmlFunction",e.FunctionName="mmlFunctionName",e.Fraction="mmlFraction",e.GroupChar="mmlGroupChar",e.Limit="mmlLimit",e.LimitLower="mmlLimitLower",e.Matrix="mmlMatrix",e.MatrixRow="mmlMatrixRow",e.Math="mmlMath",e.MathParagraph="mmlMathParagraph",e.Nary="mmlNary",e.Numerator="mmlNumerator",e.PreSubSuper="mmlPreSubSuper",e.Radical="mmlRadical",e.SubArgument="mmlSubArgument",e.Subscript="mmlSubscript",e.Superscript="mmlSuperscript"}(G||(G={}));class ue{constructor(){this.children=[],this.cssStyle={}}}!function(e){e.Column="column",e.Page="page",e.TextWrapping="textWrapping"}(q||(q={})),function(e){e.Inline="Inline",e.None="None",e.TopAndBottom="TopAndBottom",e.Tight="Tight",e.Through="Through",e.Square="Square",e.Polygon="Polygon"}(K||(K={}));class me extends ue{constructor(){super(...arguments),this.type=X.Header}}class fe extends ue{constructor(){super(...arguments),this.type=X.Footer}}class ge extends A{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.rootElement=this.createRootElement(),this.rootElement.level=1,this.rootElement.children=this._documentParser.parseBodyElements(e)}}class be extends ge{createRootElement(){return new me}}class ye extends ge{createRootElement(){return new fe}}function ve(e){if(void 0!==e)return parseInt(e)}class ke extends A{parseXml(e){this.props=function(e,t){const r={};for(let n of t.elements(e))switch(n.localName){case"Template":r.template=n.textContent;break;case"Pages":r.pages=ve(n.textContent);break;case"Words":r.words=ve(n.textContent);break;case"Characters":r.characters=ve(n.textContent);break;case"Application":r.application=n.textContent;break;case"Lines":r.lines=ve(n.textContent);break;case"Paragraphs":r.paragraphs=ve(n.textContent);break;case"Company":r.company=n.textContent;break;case"AppVersion":r.appVersion=n.textContent}return r}(e,this._package.xmlParser)}}class xe extends A{parseXml(e){this.props=function(e,t){const r={};for(let n of t.elements(e))switch(n.localName){case"title":r.title=n.textContent;break;case"description":r.description=n.textContent;break;case"subject":r.subject=n.textContent;break;case"creator":r.creator=n.textContent;break;case"keywords":r.keywords=n.textContent;break;case"language":r.language=n.textContent;break;case"lastModifiedBy":r.lastModifiedBy=n.textContent;break;case"revision":n.textContent&&(r.revision=parseInt(n.textContent))}return r}(e,this._package.xmlParser)}}class we{}function Se(e,t){var r={name:t.attr(e,"name"),colors:{}};for(let s of t.elements(e)){var n=t.element(s,"srgbClr"),a=t.element(s,"sysClr");n?r.colors[s.localName]=t.attr(n,"val"):a&&(r.colors[s.localName]=t.attr(a,"lastClr"))}return r}function Ce(e,t){var r={name:t.attr(e,"name")};for(let n of t.elements(e))switch(n.localName){case"majorFont":r.majorFont=Pe(n,t);break;case"minorFont":r.minorFont=Pe(n,t)}return r}function Pe(e,t){return{latinTypeface:t.elementAttr(e,"latin","typeface"),eaTypeface:t.elementAttr(e,"ea","typeface"),csTypeface:t.elementAttr(e,"cs","typeface")}}class Ne extends A{constructor(e,t){super(e,t)}parseXml(e){this.theme=function(e,t){var r=new we,n=t.element(e,"themeElements");for(let e of t.elements(n))switch(e.localName){case"clrScheme":r.colorScheme=Se(e,t);break;case"fontScheme":r.fontScheme=Ce(e,t)}return r}(e,this._package.xmlParser)}}class Te extends ue{constructor(){super(...arguments),this.children=[]}}class Me{}class Ae extends Te{constructor(){super(...arguments),this.type=X.Footnotes}}class Ee extends Me{constructor(){super(...arguments),this.type=X.Footnote}}class Re extends Te{constructor(){super(...arguments),this.type=X.Endnotes}}class $e extends Me{constructor(){super(...arguments),this.type=X.Endnote}}class De extends A{constructor(e,t,r){super(e,t),this._documentParser=r}}class Fe extends De{constructor(e,t,r){super(e,t,r)}parseXml(e){this.rootElement=new Ae,this.rootElement.level=1,this.rootElement.children=this._documentParser.parseNotes(e,"footnote",Ee)}}class Be extends De{constructor(e,t,r){super(e,t,r)}parseXml(e){this.rootElement=new Re,this.rootElement.level=1,this.rootElement.children=this._documentParser.parseNotes(e,"endnote",$e)}}function je(e,t){var r={defaultNoteIds:[]};for(let n of t.elements(e))switch(n.localName){case"numFmt":r.nummeringFormat=t.attr(n,"val");break;case"footnote":case"endnote":r.defaultNoteIds.push(t.attr(n,"id"))}return r}class Le extends A{constructor(e,t){super(e,t)}parseXml(e){this.settings=function(e,t){var r={};for(let n of t.elements(e))switch(n.localName){case"autoHyphenation":r.autoHyphenation=t.boolAttr(n,"val");break;case"defaultTabStop":r.defaultTabStop=t.lengthAttr(n,"val");break;case"endnotePr":r.endnoteProps=je(n,t);break;case"evenAndOddHeaders":r.evenAndOddHeaders=t.boolAttr(n,"val",!0);break;case"footnotePr":r.footnoteProps=je(n,t)}return r}(e,this._package.xmlParser)}}class Oe extends A{parseXml(e){this.props=function(e,t){return t.elements(e,"property").map(e=>{const r=e.firstChild;return{formatId:t.attr(e,"fmtid"),name:t.attr(e,"name"),type:r.nodeName,value:r.textContent}})}(e,this._package.xmlParser)}}class Ie extends A{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.comments=this._documentParser.parseComments(e),this.commentMap=s.keyBy(this.comments,"id")}}const He=[{type:h.OfficeDocument,target:"word/document.xml"},{type:h.ExtendedProperties,target:"docProps/app.xml"},{type:h.CoreProperties,target:"docProps/core.xml"},{type:h.CustomProperties,target:"docProps/custom.xml"}];class _e{constructor(){this.parts=[],this.partsMap={}}static load(e,t,r){return i(this,void 0,void 0,function*(){var n=new _e;return n._options=r,n._parser=t,n._package=yield I.load(e,r),n.rels=yield n._package.loadRelationships(),yield Promise.all(He.map(e=>{var t;const r=null!==(t=n.rels.find(t=>t.type===e.type))&&void 0!==t?t:e;return n.loadRelationshipPart(r.target,r.type)})),n})}save(e="blob"){return this._package.save(e)}loadRelationshipPart(e,t){return i(this,void 0,void 0,function*(){var r;if(this.partsMap[e])return this.partsMap[e];if(!this._package.get(e))return null;let n=null;switch(t){case h.OfficeDocument:this.documentPart=n=new H(this._package,e,this._parser);break;case h.FontTable:this.fontTablePart=n=new D(this._package,e);break;case h.Numbering:this.numberingPart=n=new pe(this._package,e,this._parser);break;case h.Styles:this.stylesPart=n=new he(this._package,e,this._parser);break;case h.Theme:this.themePart=n=new Ne(this._package,e);break;case h.Footnotes:this.footnotesPart=n=new Fe(this._package,e,this._parser);break;case h.Endnotes:this.endnotesPart=n=new Be(this._package,e,this._parser);break;case h.Footer:n=new ye(this._package,e,this._parser);break;case h.Header:n=new be(this._package,e,this._parser);break;case h.CoreProperties:this.corePropsPart=n=new xe(this._package,e);break;case h.ExtendedProperties:this.extendedPropsPart=n=new ke(this._package,e);break;case h.CustomProperties:n=new Oe(this._package,e);break;case h.Settings:this.settingsPart=n=new Le(this._package,e);break;case h.Comments:this.commentsPart=n=new Ie(this._package,e,this._parser)}if(null==n)return Promise.resolve(null);if(this.partsMap[e]=n,this.parts.push(n),yield n.load(),(null===(r=n.rels)||void 0===r?void 0:r.length)>0){const[e]=B(n.path);yield Promise.all(n.rels.map(t=>this.loadRelationshipPart(j(t.target,e),t.type)))}return n})}loadDocumentImage(e,t){return i(this,void 0,void 0,function*(){const r=yield this.loadResource(null!=t?t:this.documentPart,e,"blob");return this.blobToURL(r)})}loadNumberingImage(e){return i(this,void 0,void 0,function*(){const t=yield this.loadResource(this.numberingPart,e,"blob");return this.blobToURL(t)})}loadFont(e,t){return i(this,void 0,void 0,function*(){const r=yield this.loadResource(this.fontTablePart,e,"uint8array");return r?this.blobToURL(new Blob([ze(r,t)])):r})}loadAltChunk(e,t){return i(this,void 0,void 0,function*(){return yield this.loadResource(null!=t?t:this.documentPart,e,"string")})}blobToURL(e){return e?this._options.useBase64URL?function(e){return new Promise((t,r)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=()=>r(),n.readAsDataURL(e)})}(e):URL.createObjectURL(e):null}findPartByRelId(e,t=null){var r,n=(null!==(r=t.rels)&&void 0!==r?r:this.rels).find(t=>t.id==e);const a=t?B(t.path)[0]:"";return n?this.partsMap[j(n.target,a)]:null}getPathById(e,t){const r=e.rels.find(e=>e.id==t),[n]=B(e.path);return r?j(r.target,n):null}loadResource(e,t,r){return i(this,void 0,void 0,function*(){const n=this.getPathById(e,t);let a=u.getType(n);if(n){let e=yield this._package.load(n,r);return new Blob([e],{type:a})}return Promise.resolve(null)})}}function ze(e,t){const r=t.replace(/{|}|-/g,""),n=new Array(16);for(let e=0;e<16;e++)n[16-e-1]=parseInt(r.substring(2*e,2*e+2),16);for(let t=0;t<32;t++)e[t]=e[t]^n[t%16];return e}class Ue extends ue{constructor(){super(...arguments),this.type=X.VmlElement,this.attrs={}}}function Ve(e,t){var r=new Ue;switch(e.localName){case"rect":r.tagName="rect",Object.assign(r.attrs,{width:"100%",height:"100%"});break;case"oval":r.tagName="ellipse",Object.assign(r.attrs,{cx:"50%",cy:"50%",rx:"50%",ry:"50%"});break;case"line":r.tagName="line";break;case"shape":r.tagName="g";break;case"textbox":r.tagName="foreignObject",Object.assign(r.attrs,{width:"100%",height:"100%"});break;default:return null}for(const t of M.attrs(e))switch(t.localName){case"style":r.cssStyleText=t.value;break;case"fillcolor":r.attrs.fill=t.value;break;case"from":const[e,n]=Ge(t.value);Object.assign(r.attrs,{x1:e,y1:n});break;case"to":const[a,s]=Ge(t.value);Object.assign(r.attrs,{x2:a,y2:s})}for(const n of M.elements(e))switch(n.localName){case"stroke":Object.assign(r.attrs,We(n));break;case"fill":Object.assign(r.attrs,Xe());break;case"imagedata":r.tagName="image",Object.assign(r.attrs,{width:"100%",height:"100%"}),r.imageHref={id:M.attr(n,"id"),title:M.attr(n,"title")};break;case"txbxContent":r.children.push(...t.parseBodyElements(n));break;default:const e=Ve(n,t);e&&r.children.push(e)}return r}function We(e){var t;return{stroke:M.attr(e,"color"),"stroke-width":null!==(t=M.lengthAttr(e,"weight",b))&&void 0!==t?t:"1px"}}function Xe(e){return{}}function Ge(e){return e.split(",")}class qe extends ue{constructor(){super(...arguments),this.type=X.Comment}}class Ke extends ue{constructor(e){super(),this.id=e,this.type=X.CommentReference}}class Je extends ue{constructor(e){super(),this.id=e,this.type=X.CommentRangeStart}}class Ye extends ue{constructor(e){super(),this.id=e,this.type=X.CommentRangeEnd}}var Ze="inherit",Qe="black",et="black",tt="transparent";const rt=[],nt={oMath:X.MmlMath,oMathPara:X.MmlMathParagraph,f:X.MmlFraction,func:X.MmlFunction,fName:X.MmlFunctionName,num:X.MmlNumerator,den:X.MmlDenominator,rad:X.MmlRadical,deg:X.MmlDegree,e:X.MmlBase,sSup:X.MmlSuperscript,sSub:X.MmlSubscript,sPre:X.MmlPreSubSuper,sup:X.MmlSuperArgument,sub:X.MmlSubArgument,d:X.MmlDelimiter,nary:X.MmlNary,eqArr:X.MmlEquationArray,lim:X.MmlLimit,limLow:X.MmlLimitLower,m:X.MmlMatrix,mr:X.MmlMatrixRow,box:X.MmlBox,bar:X.MmlBar,groupChr:X.MmlGroupChar},at={ignoreWidth:!1,debug:!1,ignoreTableWrap:!0,ignoreImageWrap:!0};class st{constructor(e){this.options=Object.assign(Object.assign({},at),e)}parseDocumentFile(e){let t={uuid:"root",pages:[],sectProps:{},type:X.Document},r=M.element(e,"background");t.cssStyle=r?this.parseBackground(r):{};let n=M.element(e,"body");t.children=this.parseBodyElements(n);let a=M.element(n,"sectPr");return a&&(t.sectProps=J(a,M)),t.sectProps.sectionId=O(),t}parseBackground(e){let t={},r=lt.colorAttr(e,"color");return r&&(t["background-color"]=r),t}parseBodyElements(e){let t=[];return lt.foreach(e,e=>{switch(e.localName){case"p":t.push(this.parseParagraph(e));break;case"altChunk":t.push(this.parseAltChunk(e));break;case"tbl":t.push(this.parseTable(e));break;case"sdt":t.push(...this.parseSdt(e));break;case"sectPr":break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Body Element：${e.localName}`,"color:red")}}),t}parseAltChunk(e){return{type:X.AltChunk,children:[],id:M.attr(e,"id")}}parseStylesFile(e){let t=[];for(const r of M.elements(e))switch(r.localName){case"style":t.push(this.parseStyle(r));break;case"docDefaults":t.push(this.parseDefaultStyles(r));break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Style File：${r.localName}`,"color:#f75607")}return t}parseDefaultStyles(e){let t={basedOn:null,id:null,name:null,rulesets:[],type:null};for(const r of M.elements(e))switch(r.localName){case"rPrDefault":let e=M.element(r,"rPr");e&&t.rulesets.push({target:"span",declarations:this.parseDefaultProperties(e,{})});break;case"pPrDefault":let n=M.element(r,"pPr");if(n){let e=ae(n,M),r={target:"p",declarations:this.parseDefaultProperties(n,{})};Object.assign(r.declarations,te(e)),t.rulesets.push(r)}break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Default Style：${r.localName}`,"color:#f75607")}return t}parseStyle(e){let t={basedOn:null,id:null,name:null,rulesets:[],type:null};for(const r of M.attrs(e))switch(r.localName){case"customStyle":t.customStyle=M.boolAttr(e,"customStyle",!1);break;case"default":t.isDefault=M.boolAttr(e,"default",!1);break;case"styleId":t.id=M.attr(e,"styleId");break;case"type":t.type=M.attr(e,"type");const n={paragraph:"p",table:"table",character:"span",numbering:"p"};n.hasOwnProperty(t.type)?t.label=n[t.type]:this.options&&this.options.debug&&console.warn(`DOCX:%c Unknown Style Type：${t.type}`,"color:#f75607");break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Style Property：${r.localName}`,"color:#f75607")}for(const r of M.elements(e))switch(r.localName){case"aliases":t.aliases=M.attr(r,"val").split(",");break;case"autoRedefine":t.autoRedefine=!0;break;case"basedOn":t.basedOn=M.attr(r,"val");break;case"hidden":t.hidden=!0;break;case"link":t.linked=M.attr(r,"val");break;case"locked":t.locked=!0;break;case"name":t.name=M.attr(r,"val");break;case"next":t.next=M.attr(r,"val");break;case"personal":t.personal=M.boolAttr(r,"val");break;case"personalCompose":t.personalCompose=M.boolAttr(r,"val");break;case"personalReply":t.personalReply=M.boolAttr(r,"val");break;case"pPr":t.paragraphProps=ae(r,M);let e={target:"p",declarations:this.parseDefaultProperties(r,{})};Object.assign(e.declarations,te(t.paragraphProps)),t.rulesets.push(e);break;case"qFormat":t.primaryStyle=!0;break;case"rPr":t.rulesets.push({target:"span",declarations:this.parseDefaultProperties(r,{})}),t.runProps=re(r,M);break;case"rsid":t.rsid=M.hexAttr(r,"val");break;case"semiHidden":t.semiHidden=!0;break;case"tblPr":case"tcPr":t.rulesets.push({target:"td",declarations:this.parseDefaultProperties(r,{})});break;case"trPr":t.rulesets.push({target:"tr",declarations:this.parseDefaultProperties(r,{})});break;case"tblStylePr":for(let e of this.parseTableStyle(r))t.rulesets.push(e);break;case"uiPriority":t.uiPriority=M.intAttr(r,"val",1/0);break;case"unhideWhenUsed":t.unhideWhenUsed=!0;break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Style element：${r.localName}`,"color:blue")}return t}parseTableStyle(e){let t=[],r="",n="";switch(M.attr(e,"type")){case"firstRow":n=".first-row",r="tr.first-row td";break;case"lastRow":n=".last-row",r="tr.last-row td";break;case"firstCol":n=".first-col",r="td.first-col";break;case"lastCol":n=".last-col",r="td.last-col";break;case"band1Vert":n=":not(.no-vband)",r="td.odd-col";break;case"band2Vert":n=":not(.no-vband)",r="td.even-col";break;case"band1Horz":n=":not(.no-hband)",r="tr.odd-row";break;case"band2Horz":n=":not(.no-hband)",r="tr.even-row";break;default:return[]}for(const a of M.elements(e))switch(a.localName){case"pPr":let e=ae(a,M),s={target:`${r} p`,modifier:n,declarations:this.parseDefaultProperties(a,{})};Object.assign(s.declarations,te(e)),t.push(s);break;case"rPr":t.push({target:`${r} span`,modifier:n,declarations:this.parseDefaultProperties(a,{})});break;case"tblPr":case"tcPr":t.push({target:r,modifier:n,declarations:this.parseDefaultProperties(a,{})});break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Style：${a.localName}`,"color:#f75607")}return t}parseNumberingFile(e){let t=[];const r={};let n=[];for(const a of M.elements(e))switch(a.localName){case"abstractNum":this.parseAbstractNumbering(a,n).forEach(e=>t.push(e));break;case"numPicBullet":n.push(this.parseNumberingPicBullet(a));break;case"num":let e=M.attr(a,"numId"),s=M.elementAttr(a,"abstractNumId","val");r[s]=e;break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Numbering File：${a.localName}`,"color:#f75607")}return t.forEach(e=>e.id=r[e.id]),t}parseNumberingPicBullet(e){let t=M.element(e,"pict"),r=t&&M.element(t,"shape"),n=r&&M.element(r,"imagedata");return n?{id:M.intAttr(e,"numPicBulletId"),src:M.attr(n,"id"),style:M.attr(r,"style")}:null}parseAbstractNumbering(e,t){let r=[],n=M.attr(e,"abstractNumId");for(const a of M.elements(e))if("lvl"===a.localName)r.push(this.parseNumberingLevel(n,a,t));else this.options.debug&&console.warn(`DOCX:%c Unknown Abstract Numbering：${a.localName}`,"color:#f75607");return r}parseNumberingLevel(e,t,r){let n={id:e,level:M.intAttr(t,"ilvl"),start:1,pStyleName:void 0,pStyle:{},rStyle:{},suff:"tab"};for(const e of M.elements(t))switch(e.localName){case"start":n.start=M.intAttr(e,"val");break;case"pPr":this.parseDefaultProperties(e,n.pStyle);break;case"rPr":this.parseDefaultProperties(e,n.rStyle);break;case"lvlPicBulletId":let t=M.intAttr(e,"val");n.bullet=r.find(e=>(null==e?void 0:e.id)==t);break;case"lvlText":n.levelText=M.attr(e,"val");break;case"pStyle":n.pStyleName=M.attr(e,"val");break;case"numFmt":n.format=M.attr(e,"val");break;case"suff":n.suff=M.attr(e,"val");break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Numbering Level：${e.localName}`,"color:#f75607")}return n}parseSdt(e){let t=[];const r=M.element(e,"sdtContent");return r&&(t=this.parseBodyElements(r)),t}parseNotes(e,t,r){let n=[];for(let a of M.elements(e,t)){const e=new r;e.id=M.attr(a,"id"),e.noteType=M.attr(a,"type"),e.children=this.parseBodyElements(a),n.push(e)}return n}parseComments(e){let t=[];for(let r of M.elements(e,"comment")){const e=new qe;e.id=M.attr(r,"id"),e.author=M.attr(r,"author"),e.initials=M.attr(r,"initials"),e.date=M.attr(r,"date"),e.children=this.parseBodyElements(r),t.push(e)}return t}parseInserted(e){let t={type:X.Inserted,children:[]};return lt.foreach(e,e=>{if("r"===e.localName)t.children.push(this.parseRun(e));else this.options.debug&&console.warn(`DOCX:%c Unknown Inserted：${e.localName}`,"color:#f75607")}),t}parseDeleted(e){let t={type:X.Deleted,children:[]};return lt.foreach(e,e=>{if("r"===e.localName)t.children.push(this.parseRun(e));else this.options.debug&&console.warn(`DOCX:%c Unknown Inserted：${e.localName}`,"color:#f75607")}),t}parseParagraph(e){let t={type:X.Paragraph,children:[],props:{},cssStyle:{}};if(lt.foreach(e,e=>{switch(e.localName){case"pPr":this.parseParagraphProperties(e,t);break;case"r":t.children.push(this.parseRun(e));break;case"hyperlink":t.children.push(this.parseHyperlink(e));break;case"bookmarkStart":t.children.push((r=e,n=M,{type:X.BookmarkStart,id:n.attr(r,"id"),name:n.attr(r,"name"),colFirst:n.intAttr(r,"colFirst"),colLast:n.intAttr(r,"colLast")}));break;case"bookmarkEnd":t.children.push(function(e,t){return{type:X.BookmarkEnd,id:t.attr(e,"id")}}(e,M));break;case"commentRangeStart":t.children.push(new Je(M.attr(e,"id")));break;case"commentRangeEnd":t.children.push(new Ye(M.attr(e,"id")));break;case"oMath":case"oMathPara":t.children.push(this.parseMathElement(e));break;case"sdt":t.children.push(...this.parseSdt(e));break;case"ins":t.children.push(this.parseInserted(e));break;case"del":t.children.push(this.parseDeleted(e));break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Paragraph Element：${e.localName}`,"color:#f75607")}var r,n}),0===t.children.length){let e={type:X.Break,break:q.TextWrapping},r={type:X.Run,children:[e]};t.children=[r]}return t}parseParagraphProperties(e,t){this.parseDefaultProperties(e,t.cssStyle={},null,e=>{if(se(e,t.props,M))return!0;switch(e.localName){case"cnfStyle":t.className=ot.classNameOfCnfStyle(e);break;case"framePr":this.parseFrame(e,t);break;case"pStyle":t.styleName=M.attr(e,"val");break;default:return!1}return!0})}parseFrame(e,t){"drop"==M.attr(e,"dropCap")&&(t.cssStyle.float="left")}parseHyperlink(e){let t={type:X.Hyperlink,children:[]},r=M.attr(e,"anchor"),n=M.attr(e,"id");return r&&(t.href="#"+r),n&&(t.id=n),lt.foreach(e,e=>{if("r"===e.localName)t.children.push(this.parseRun(e));else this.options.debug&&console.warn(`DOCX:%c Unknown Hyperlink Element：${e.localName}`,"color:#f75607")}),t}parseSmartTag(e,t){var r={type:X.SmartTag,parent:t,children:[]},n=M.attr(e,"uri"),a=M.attr(e,"element");n&&(r.uri=n),a&&(r.element=a);for(const t of M.elements(e))if("r"===t.localName)r.children.push(this.parseRun(t));return r}parseRun(e){let t={type:X.Run,children:[]};return lt.foreach(e,e=>{switch((e=this.checkAlternateContent(e)).localName){case"rPr":this.parseRunProperties(e,t);break;case"t":t.children.push(this.parseText(e,X.Text));break;case"delText":t.children.push(this.parseText(e,X.DeletedText));break;case"commentReference":t.children.push(new Ke(M.attr(e,"id")));break;case"fldSimple":t.children.push({type:X.SimpleField,instruction:M.attr(e,"instr"),lock:M.boolAttr(e,"lock",!1),dirty:M.boolAttr(e,"dirty",!1)});break;case"instrText":t.fieldRun=!0,t.children.push(this.parseText(e,X.Instruction));break;case"fldChar":t.fieldRun=!0,t.children.push({type:X.ComplexField,charType:M.attr(e,"fldCharType"),lock:M.boolAttr(e,"lock",!1),dirty:M.boolAttr(e,"dirty",!1)});break;case"noBreakHyphen":t.children.push({type:X.NoBreakHyphen});break;case"br":t.children.push({type:X.Break,break:M.attr(e,"type")||"textWrapping",props:{clear:M.attr(e,"clear")}});break;case"lastRenderedPageBreak":t.children.push({type:X.LastRenderedPageBreak});break;case"sym":t.children.push({type:X.Symbol,font:M.attr(e,"font"),char:M.attr(e,"char")});break;case"ptab":break;case"tab":t.children.push({type:X.Tab});break;case"footnoteReference":t.children.push({type:X.FootnoteReference,id:M.attr(e,"id")});break;case"endnoteReference":t.children.push({type:X.EndnoteReference,id:M.attr(e,"id")});break;case"drawing":t.children.push(this.parseDrawing(e));break;case"pict":t.children.push(this.parseVmlPicture(e));break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Run Element：${e.localName}`,"color:#f75607")}}),t}parseText(e,t){let r={type:t,text:""},n=e.textContent;return"preserve"===M.attr(e,"xml:space")&&(n=n.split(/\s/).join(" ")),r.text=n,n.length>0&&(r.children=this.parseCharacter(n)),r}parseCharacter(e){let t=[];return t=e.match(/[\u4e00-\u9fa5]+/g)?e.split(""):e.match(/\S+|\s+/g),t.map(e=>({type:X.Character,char:e}))}parseRunProperties(e,t){this.parseDefaultProperties(e,t.cssStyle={},null,e=>{switch(e.localName){case"rStyle":t.styleName=M.attr(e,"val");break;case"vertAlign":t.verticalAlign=ot.valueOfVertAlign(e,!0);break;case"spacing":this.parseSpacing(e,t);break;default:return!1}return!0})}parseMathElement(e){const t=`${e.localName}Pr`,r={type:nt[e.localName],children:[]};return lt.foreach(e,e=>{if(nt[e.localName])r.children.push(this.parseMathElement(e));else if("r"==e.localName){let t=this.parseRun(e);t.type=X.MmlRun,r.children.push(t)}else e.localName==t&&(r.props=this.parseMathProperties(e))}),r}parseMathProperties(e){const t={};for(const r of M.elements(e))switch(r.localName){case"chr":t.char=M.attr(r,"val");break;case"vertJc":t.verticalJustification=M.attr(r,"val");break;case"pos":t.position=M.attr(r,"val");break;case"degHide":t.hideDegree=M.boolAttr(r,"val");break;case"begChr":t.beginChar=M.attr(r,"val");break;case"endChr":t.endChar=M.attr(r,"val");break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Math Property：${r.localName}`,"color:#f75607")}return t}parseVmlPicture(e){const t={type:X.VmlPicture,children:[]};for(const r of M.elements(e)){const e=Ve(r,this);e&&t.children.push(e)}return t}checkAlternateContent(e){var t;if("AlternateContent"!=e.localName)return e;let r=M.element(e,"Choice");if(r){let t=M.attr(r,"Requires"),n=e.lookupNamespaceURI(t);if(rt.includes(n))return r.firstElementChild}return null===(t=M.element(e,"Fallback"))||void 0===t?void 0:t.firstElementChild}parseDrawing(e){for(let t of M.elements(e))switch(t.localName){case"inline":case"anchor":return this.parseDrawingWrapper(t);default:this.options.debug&&console.warn(`DOCX:%c Unknown Drawing Element：${t.localName}`,"color:#f75607")}}parseDrawingWrapper(e){var t,r;let n=M.boolAttr(e,"layoutInCell"),a=M.boolAttr(e,"locked"),s=M.boolAttr(e,"behindDoc"),i=M.boolAttr(e,"allowOverlap"),l=M.boolAttr(e,"simplePos"),o=M.intAttr(e,"relativeHeight",1),c={left:M.lengthAttr(e,"distL",b),right:M.lengthAttr(e,"distR",b),top:M.lengthAttr(e,"distT",b),bottom:M.lengthAttr(e,"distB",b),distL:M.intAttr(e,"distL",0),distR:M.intAttr(e,"distR",0),distT:M.intAttr(e,"distT",0),distB:M.intAttr(e,"distB",0)},d={type:X.Drawing,children:[],cssStyle:{},props:{localName:e.localName,wrapType:null,layoutInCell:n,locked:a,behindDoc:s,allowOverlap:i,simplePos:l,relativeHeight:o,distance:c,extent:{}}},p={relative:"page",align:"left",offset:"0pt",origin:0},h={relative:"page",align:"top",offset:"0pt",origin:0};for(let n of M.elements(e))switch(n.localName){case"simplePos":l&&(p.offset=M.lengthAttr(n,"x",b),h.offset=M.lengthAttr(n,"y",b),p.origin=M.intAttr(n,"x",0),h.origin=M.intAttr(n,"y",0));break;case"positionH":if(!l){let e=M.element(n,"align"),r=M.element(n,"posOffset");p.relative=null!==(t=M.attr(n,"relativeFrom"))&&void 0!==t?t:p.relative,e&&(p.align=e.textContent),r&&(p.offset=lt.sizeValue(r,b),p.origin=lt.parseTextContent(r)),d.props.posX=p}break;case"positionV":if(!l){let e=M.element(n,"align"),t=M.element(n,"posOffset");h.relative=null!==(r=M.attr(n,"relativeFrom"))&&void 0!==r?r:h.relative,e&&(h.align=e.textContent),t&&(h.offset=lt.sizeValue(t,b),h.origin=lt.parseTextContent(t)),d.props.posY=h}break;case"extent":d.props.extent={width:M.lengthAttr(n,"cx",b),height:M.lengthAttr(n,"cy",b),origin_width:M.intAttr(n,"cx",0),origin_height:M.intAttr(n,"cy",0)};break;case"effectExtent":d.props.effectExtent={top:M.lengthAttr(n,"t",b),bottom:M.lengthAttr(n,"b",b),left:M.lengthAttr(n,"l",b),right:M.lengthAttr(n,"r",b),origin_top:M.intAttr(n,"t",0),origin_bottom:M.intAttr(n,"b",0),origin_left:M.intAttr(n,"l",0),origin_right:M.intAttr(n,"r",0)};break;case"graphic":let e=this.parseGraphic(n);e&&d.children.push(e);break;case"wrapTopAndBottom":d.props.wrapType=K.TopAndBottom;break;case"wrapNone":d.props.wrapType=K.None;break;case"wrapSquare":d.props.wrapType=K.Square,d.props.wrapText=M.attr(n,"wrapText");break;case"wrapThrough":case"wrapTight":d.props.wrapType=K.Tight,d.props.wrapText=M.attr(n,"wrapText");let a=M.element(n,"wrapPolygon");this.parsePolygon(a,d);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Drawing Property：${n.localName}`,"color:#f75607")}let{extent:u,effectExtent:m}=d.props,f=u.origin_width+m.origin_left+m.origin_right,g=u.origin_height+m.origin_top+m.origin_bottom;if(d.cssStyle.width=P(f,b),d.cssStyle.height=P(g,b),"inline"===e.localName&&(d.props.wrapType=K.Inline),"anchor"===e.localName){d.cssStyle.position="relative",d.cssStyle["z-index"]=s?-1:o,this.options.ignoreImageWrap&&(d.props.wrapType=K.Inline);let{wrapText:e,wrapType:t}=d.props;switch(t){case K.TopAndBottom:d.cssStyle.float="left",d.cssStyle.width="100%",d.cssStyle["text-align"]=p.align,d.cssStyle.transform=`translate(${p.offset},0)`,d.cssStyle["margin-top"]=`calc(${h.offset} - ${c.top})`,d.cssStyle["shape-outside"]=`inset(calc(${h.offset} - ${c.top}) 0 0 0)`,d.cssStyle["box-sizing"]="content-box",d.cssStyle["padding-top"]=c.top,d.cssStyle["padding-bottom"]=c.bottom;break;case K.None:switch(d.cssStyle.position="absolute",p.align){case"left":case"right":d.cssStyle[p.align]=p.offset;break;case"center":d.cssStyle.left="50%",d.cssStyle.transform="translateX(-50%)"}d.cssStyle.top=h.offset;break;case K.Square:switch(d.cssStyle.float="left"===e?"right":"left",d.cssStyle["margin-top"]=`calc(${h.offset} - ${c.top})`,d.cssStyle["shape-outside"]=`inset(calc(${h.offset} - ${c.top}) 0 0 0)`,e){case"left":switch(p.align){case"left":d.cssStyle["margin-right"]=`calc(100% - ${u.width} - ${p.offset} - ${c.right})`;break;case"right":d.cssStyle["margin-right"]=`calc(${p.offset} - ${c.right})`;break;case"center":d.cssStyle["margin-right"]=`calc( 50% - (${u.width} - ${p.offset}) / 2 - ${c.right} )`}break;case"right":switch(p.align){case"left":d.cssStyle["margin-left"]=`calc(${p.offset} - ${c.left})`;break;case"right":d.cssStyle["margin-left"]=`calc(100% - ${u.width} - ${p.offset} - ${c.left})`,d.cssStyle["margin-right"]=`calc(${p.offset} - ${c.right})`;break;case"center":d.cssStyle["margin-left"]=`calc( 50% - (${u.width} - ${p.offset} ) / 2 - ${c.left} )`}break;default:console.error(`text wrap picture on ${e} is not supported！`)}d.cssStyle["box-sizing"]="content-box",d.cssStyle["padding-top"]=c.top,d.cssStyle["padding-bottom"]=c.bottom,d.cssStyle["padding-left"]=c.left,d.cssStyle["padding-right"]=c.right;break;case K.Through:case K.Tight:d.cssStyle.float="left"===e?"right":"left";let{polygonData:t}=d.props;switch(d.cssStyle["shape-outside"]=`polygon(${t})`,d.cssStyle["margin-top"]=h.offset,e){case"left":switch(p.align){case"left":d.cssStyle["margin-right"]=`calc(100% - ${u.width} - ${p.offset})`;break;case"right":d.cssStyle["margin-right"]=p.offset;break;case"center":d.cssStyle["margin-right"]=`calc( 50% - (${u.width} - ${p.offset}) / 2 )`}break;case"right":switch(p.align){case"left":d.cssStyle["margin-left"]=p.offset;break;case"right":d.cssStyle["margin-left"]=`calc(100% - ${u.width} - ${p.offset})`;break;case"center":d.cssStyle["margin-left"]=`calc( 50% - (${u.width} - ${p.offset} ) / 2 )`}break;default:console.error(`text wrap picture on ${e} is not supported！`)}}}return d}parsePolygon(e,t){let r=[],{wrapText:n,distance:a,extent:s,posX:i,posY:l}=t.props;lt.foreach(e,e=>{var t,o,c,d,p,h,u,m,f,g,y,v;let k,x,w,S,C,N,T=M.intAttr(e,"x",0),A=M.intAttr(e,"y",0);switch(n){case"left":switch(i.align){case"left":k=T*s.origin_width/21600-a.distL,x=A*s.origin_height/21600+l.origin,C=null!==(t=P(k,b))&&void 0!==t?t:"0pt",N=null!==(o=P(x,b))&&void 0!==o?o:"0pt";break;case"right":k=T*s.origin_width/21600+i.origin-a.distL,x=A*s.origin_height/21600+l.origin,C=null!==(c=P(k,b))&&void 0!==c?c:"0pt",N=null!==(d=P(x,b))&&void 0!==d?d:"0pt";break;case"center":k=T*s.origin_width/21600+i.origin-a.distL,x=A*s.origin_height/21600+l.origin,C=null!==(p=P(k,b))&&void 0!==p?p:"0pt",N=null!==(h=P(x,b))&&void 0!==h?h:"0pt"}break;case"right":switch(i.align){case"left":k=T*s.origin_width/21600+i.origin+a.distR,x=A*s.origin_height/21600+l.origin,C=null!==(u=P(k,b))&&void 0!==u?u:"0pt",N=null!==(m=P(x,b))&&void 0!==m?m:"0pt";break;case"right":k=T*s.origin_width/21600+i.origin+a.distR,x=A*s.origin_height/21600+l.origin,w=null!==(f=P(k,b))&&void 0!==f?f:"0pt",S=null!==(g=P(x,b))&&void 0!==g?g:"0pt",C=`calc(100% + ${w} - ${s.width})`,N=S;break;case"center":k=T*s.origin_width/21600+i.origin+a.distR,x=A*s.origin_height/21600+l.origin,w=null!==(y=P(k,b))&&void 0!==y?y:"0pt",S=null!==(v=P(x,b))&&void 0!==v?v:"0pt",C=`calc(50% + ${w})`,N=S}break;default:console.error(`text wrap picture on ${n} is not supported！`)}let E=`${C} ${N}`;r.push(E)}),t.props.polygonData=r.join(",")}parseGraphic(e){let t=M.element(e,"graphicData");for(let e of M.elements(t))switch(e.localName){case"wsp":return this.parseShape(e);case"pic":return this.parsePicture(e);default:this.options.debug&&console.warn(`DOCX:%c Unknown Graphic Element：${e.localName}`,"color:#f75607")}return null}parseShape(e){let t={type:X.Shape,cssStyle:{}};for(let r of M.elements(e))switch(r.localName){case"cNvPr":case"cNvSpPr":case"cNvCnPr":case"spPr":return this.parseShapeProperties(r,t);default:this.options.debug&&console.warn(`DOCX:%c Unknown Shape Element：${r.localName}`,"color:#f75607")}return null}parseShapeProperties(e,t){for(let r of M.elements(e))if("xfrm"===r.localName){M.boolAttr(r,"flipH")&&(t.props.is_transform=!0,t.props.transform.scaleX=-1),M.boolAttr(r,"flipV")&&(t.props.is_transform=!0,t.props.transform.scaleY=-1);let e=M.numberAttr(r,"rot",C,0);e&&(t.props.is_transform=!0,t.props.transform.rotate=e),this.parseTransform2D(r,t)}else this.options.debug&&console.warn(`DOCX:%c Unknown Shape Property：${r.localName}`,"color:#f75607");return null}parsePicture(e){let t={type:X.Image,src:"",cssStyle:{},props:{is_clip:!1,clip:{},is_transform:!1,transform:{}}};for(let r of M.elements(e))switch(r.localName){case"nvPicPr":break;case"blipFill":this.parseBlipFill(r,t);break;case"spPr":this.parseShapeProperties(r,t);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Picture Element：${r.localName}`,"color:#f75607")}return t}parseTransform2D(e,t){for(let r of M.elements(e))switch(r.localName){case"ext":let e,n,{transform:a}=t.props,s=M.intAttr(r,"cx",0),i=M.intAttr(r,"cy",0);if(null==a?void 0:a.rotate){let t=Math.PI*a.rotate/180;e=Math.abs(s*Math.cos(t)+i*Math.sin(t)),n=Math.abs(s*Math.sin(t)+i*Math.cos(t))}else e=s,n=i;t.props.width=P(e,f,!1),t.props.height=P(n,f,!1),t.cssStyle.width=P(e,b,!0),t.cssStyle.height=P(n,b,!0);break;case"off":t.cssStyle.left=M.lengthAttr(r,"x",b),t.cssStyle.top=M.lengthAttr(r,"y",b);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Transform2D Element：${r.localName}`,"color:#f75607")}}parseBlipFill(e,t){for(let r of M.elements(e))switch(r.localName){case"blip":t.src=M.attr(r,"embed"),this.parseBlip(r,t);break;case"srcRect":let e=M.numberAttr(r,"l",x,0),n=M.numberAttr(r,"r",x,0),a=M.numberAttr(r,"t",x,0),s=M.numberAttr(r,"b",x,0);t.props.is_clip=[e,n,a,s].some(e=>0!==e),t.props.clip.type="inset",t.props.clip.path={top:a,right:n,bottom:s,left:e};break;case"stretch":case"tile":break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Blip Fill Element：${r.localName}`,"color:#f75607")}}parseBlip(e,t){for(let r of M.elements(e))switch(r.localName){case"alphaBiLevel":case"alphaCeiling":case"alphaFloor":case"alphaInv":case"alphaMod":break;case"alphaModFix":let e=M.lengthAttr(r,"amt",S);t.cssStyle.opacity=e;break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Blip Element：${r.localName}`,"color:#f75607")}}parseTable(e){let t={type:X.Table,children:[]};for(const r of M.elements(e))switch(r.localName){case"tblPr":this.parseTableProperties(r,t);break;case"tblGrid":t.columns=this.parseTableColumns(r);break;case"tr":t.children.push(this.parseTableRow(r));break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Element：${r.localName}`,"color:#f75607")}return t}parseTableColumns(e){let t=[];for(const r of M.elements(e))switch(r.localName){case"gridCol":t.push({width:M.lengthAttr(r,"w")});break;case"tblGridChange":break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Columns Element：${r.localName}`,"color:#f75607")}return t}parseTableProperties(e,t){switch(t.cssStyle={},t.cellStyle={},this.parseDefaultProperties(e,t.cssStyle,t.cellStyle,e=>{switch(e.localName){case"tblStyle":t.styleName=M.attr(e,"val");break;case"tblLook":t.className=ot.classNameOftblLook(e);break;case"tblpPr":this.parseTablePosition(e,t);break;case"tblStyleColBandSize":t.colBandSize=M.intAttr(e,"val");break;case"tblStyleRowBandSize":t.rowBandSize=M.intAttr(e,"val");break;case"hidden":t.cssStyle.display="none";break;default:return!1}return!0}),t.cssStyle["text-align"]){case"center":delete t.cssStyle["text-align"],t.cssStyle["margin-left"]="auto",t.cssStyle["margin-right"]="auto";break;case"right":delete t.cssStyle["text-align"],t.cssStyle["margin-left"]="auto";break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Align：${t.cssStyle["text-align"]}`,"color:#f75607")}}parseTablePosition(e,t){if(this.options.ignoreTableWrap)return!1;let r=M.lengthAttr(e,"topFromText"),n=M.lengthAttr(e,"bottomFromText"),a=M.lengthAttr(e,"rightFromText"),s=M.lengthAttr(e,"leftFromText");t.cssStyle.float="left",t.cssStyle["margin-bottom"]=ot.addSize(t.cssStyle["margin-bottom"],n),t.cssStyle["margin-left"]=ot.addSize(t.cssStyle["margin-left"],s),t.cssStyle["margin-right"]=ot.addSize(t.cssStyle["margin-right"],a),t.cssStyle["margin-top"]=ot.addSize(t.cssStyle["margin-top"],r)}parseTableRow(e){let t={type:X.Row,children:[]};for(const r of M.elements(e))switch(r.localName){case"tc":t.children.push(this.parseTableCell(r));break;case"trPr":case"tblPrEx":this.parseTableRowProperties(r,t);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Row Element：${r.localName}`,"color:#f75607")}return t}parseTableRowProperties(e,t){t.cssStyle=this.parseDefaultProperties(e,{},null,e=>{switch(e.localName){case"cnfStyle":t.className=ot.classNameOfCnfStyle(e);break;case"tblHeader":t.isHeader=M.boolAttr(e,"val",!0);break;case"gridBefore":t.gridBefore=M.intAttr(e,"val");break;case"gridAfter":t.gridAfter=M.intAttr(e,"val");break;default:return!1}return!0})}parseTableCell(e){let t={type:X.Cell,children:[]};for(const r of M.elements(e))switch(r.localName){case"tbl":t.children.push(this.parseTable(r));break;case"p":t.children.push(this.parseParagraph(r));break;case"tcPr":this.parseTableCellProperties(r,t);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Table Cell Element：${r.localName}`,"color:#f75607")}return t}parseTableCellProperties(e,t){t.cssStyle=this.parseDefaultProperties(e,{},null,e=>{var r;switch(e.localName){case"gridSpan":t.span=M.intAttr(e,"val",null);break;case"vMerge":t.verticalMerge=null!==(r=M.attr(e,"val"))&&void 0!==r?r:"continue";break;case"cnfStyle":t.className=ot.classNameOfCnfStyle(e);break;default:return!1}return!0}),this.parseTableCellVerticalText(e,t)}parseTableCellVerticalText(e,t){const r={btLr:{writingMode:"vertical-rl",transform:"rotate(180deg)"},lrTb:{writingMode:"vertical-lr",transform:"none"},tbRl:{writingMode:"vertical-rl",transform:"none"}};for(const n of M.elements(e))if("textDirection"===n.localName){const e=r[M.attr(n,"val")]||{writingMode:"horizontal-tb"};t.cssStyle["writing-mode"]=e.writingMode,t.cssStyle.transform=e.transform}}parseDefaultProperties(e,t=null,r=null,n=null){return t=t||{},lt.foreach(e,a=>{if(!(null==n?void 0:n(a)))switch(a.localName){case"b":t["font-weight"]=M.boolAttr(a,"val",!0)?"bold":"normal";break;case"bidi":case"bCs":case"cs":case"dstrike":case"eastAsianLayout":case"effect":case"em":case"emboss":case"fitText":case"iCs":case"imprint":case"kern":case"noProof":case"outline":case"rPrChange":case"rtl":case"shadow":case"specVanish":case"szCs":case"vertAlign":case"w":case"webHidden":case"noWrap":break;case"bdr":t.border=ot.valueOfBorder(a);break;case"caps":t["text-transform"]=M.boolAttr(a,"val",!0)?"uppercase":"none";break;case"color":t.color=lt.colorAttr(a,"val",null,Qe);break;case"highlight":t["background-color"]=lt.colorAttr(a,"val",null,tt);break;case"i":t["font-style"]=M.boolAttr(a,"val",!0)?"italic":"normal";break;case"lang":t.$lang=M.attr(a,"val");break;case"position":t.verticalAlign=M.lengthAttr(a,"val",y);break;case"rFonts":this.parseFont(a,t);break;case"shd":t["background-color"]=lt.colorAttr(a,"fill",null,Ze);break;case"smallCaps":t["font-variant"]=M.boolAttr(a,"val",!0)?"small-caps":"none";break;case"strike":t["text-decoration"]=M.boolAttr(a,"val",!0)?"line-through":"none";break;case"sz":t["font-size"]=t["min-height"]=M.lengthAttr(a,"val",y);break;case"u":this.parseUnderline(a,t);break;case"vanish":M.boolAttr(a,"val",!0)&&(t.display="none");break;case"jc":t["text-align"]=ot.valueOfJc(a);break;case"textAlignment":case"vAlign":t["vertical-align"]=ot.valueOfTextAlignment(a);break;case"tcW":this.options.ignoreWidth;break;case"tblW":t.width=ot.valueOfSize(a,"w");break;case"trHeight":this.parseTrHeight(a,t);break;case"ind":case"tblInd":this.parseIndentation(a,t);break;case"tblBorders":this.parseBorderProperties(a,r||t);break;case"tblCellSpacing":t["border-spacing"]=ot.valueOfMargin(a),t["border-collapse"]="separate";break;case"pBdr":case"tcBorders":this.parseBorderProperties(a,t);break;case"tblCellMar":case"tcMar":this.parseMarginProperties(a,r||t);break;case"tblLayout":t["table-layout"]=ot.valueOfTblLayout(a);break;case"wordWrap":M.boolAttr(a,"val")&&(t["overflow-wrap"]="break-word");break;case"suppressAutoHyphens":t.hyphens=M.boolAttr(a,"val",!0)?"none":"auto";break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Property Element：${e.localName}.${a.localName}`,"color:green")}}),t}parseUnderline(e,t){let r=M.attr(e,"val");if(null==r)return;switch(r){case"dash":case"dashDotDotHeavy":case"dashDotHeavy":case"dashedHeavy":case"dashLong":case"dashLongHeavy":case"dotDash":case"dotDotDash":t["text-decoration"]="underline dashed";break;case"dotted":case"dottedHeavy":t["text-decoration"]="underline dotted";break;case"double":t["text-decoration"]="underline double";break;case"single":case"thick":case"words":t["text-decoration"]="underline";break;case"wave":case"wavyDouble":case"wavyHeavy":t["text-decoration"]="underline wavy";break;case"none":t["text-decoration"]="none";break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Underline Property：${r}`,"color:#f75607")}let n=lt.colorAttr(e,"color");n&&(t["text-decoration-color"]=n)}parseFont(e,t){let r=new Set,n=M.attr(e,"ascii"),a=ot.themeValue(e,"asciiTheme");r.add(n).add(a);let s=M.attr(e,"eastAsia"),i=ot.themeValue(e,"eastAsiaTheme");r.add(s).add(i);let l=M.attr(e,"cs"),o=ot.themeValue(e,"cstheme");r.add(l).add(o);let c=M.attr(e,"hAnsi"),d=ot.themeValue(e,"hAnsiTheme");r.add(c).add(d);let p=[...r].filter(e=>e);p.length>0&&(t["font-family"]=p.join(", ")),t._hint=M.attr(e,"hint")}parseIndentation(e,t){let r={};for(const t of M.attrs(e))switch(t.localName){case"end":r.end=M.lengthAttr(e,"end");break;case"endChars":r.endCharacters=M.lengthAttr(e,"endChars");break;case"firstLine":r.firstLine=M.lengthAttr(e,"firstLine");break;case"firstLineChars":r.firstLineChars=M.lengthAttr(e,"firstLineChars");break;case"hanging":r.hanging=M.lengthAttr(e,"hanging");break;case"hangingChars":r.hangingChars=M.lengthAttr(e,"hangingChars");break;case"left":r.left=M.lengthAttr(e,"left");break;case"leftChars":r.leftChars=M.lengthAttr(e,"leftChars");break;case"right":r.right=M.lengthAttr(e,"right");break;case"rightChars":r.rightChars=M.lengthAttr(e,"rightChars");break;case"start":r.start=M.lengthAttr(e,"start");break;case"startChars":r.startChars=M.lengthAttr(e,"startChars");break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Indentation Property：${t.localName}`,"color:#f75607")}r.firstLine&&(t["text-indent"]=r.firstLine),r.hanging&&(t["text-indent"]=`-${r.hanging}`),(r.left||r.start)&&(t["padding-left"]=r.left||r.start),(r.right||r.end)&&(t["padding-right"]=r.right||r.end)}parseSpacing(e,t){for(const r of M.attrs(e))if("val"===r.localName)t.cssStyle["margin-bottom"]=M.lengthAttr(e,"val");else this.options.debug&&console.warn(`DOCX:%c Unknown Spacing Property：${r.localName}`,"color:#f75607")}parseMarginProperties(e,t){for(const r of M.elements(e))switch(r.localName){case"left":t["padding-left"]=ot.valueOfMargin(r);break;case"right":t["padding-right"]=ot.valueOfMargin(r);break;case"top":t["padding-top"]=ot.valueOfMargin(r);break;case"bottom":t["padding-bottom"]=ot.valueOfMargin(r);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Margin Property：${r.localName}`,"color:#f75607")}}parseTrHeight(e,t){M.attr(e,"hRule"),t.height=M.lengthAttr(e,"val")}parseBorderProperties(e,t){for(const r of M.elements(e))switch(r.localName){case"start":case"left":t["border-left"]=ot.valueOfBorder(r);break;case"end":case"right":t["border-right"]=ot.valueOfBorder(r);break;case"top":t["border-top"]=ot.valueOfBorder(r);break;case"bottom":t["border-bottom"]=ot.valueOfBorder(r);break;default:this.options.debug&&console.warn(`DOCX:%c Unknown Border Property：${r.localName}`,"color:#f75607")}}}const it=["black","blue","cyan","darkBlue","darkCyan","darkGray","darkGreen","darkMagenta","darkRed","darkYellow","green","lightGray","magenta","none","red","white","yellow"];class lt{static foreach(e,t){for(let r=0;r<e.children.length;r++){let n=e.children[r];n.nodeType==Node.ELEMENT_NODE&&t(n,r)}}static colorAttr(e,t,r=null,n="black"){let a=M.attr(e,t);if(a)return"auto"==a?n:it.includes(a)?a:`#${a}`;let s=M.attr(e,"themeColor");return s?`var(--docx-${s}-color)`:r}static sizeValue(e,t=g){return P(e.textContent,t)}static parseTextContent(e,t=0){let r=e.textContent;return r?parseInt(r):t}}class ot{static themeValue(e,t){let r=M.attr(e,t);return r?`var(--docx-${r}-font)`:null}static valueOfSize(e,t){let r=g;switch(M.attr(e,"type")){case"dxa":break;case"pct":r=w;break;case"auto":return"auto"}return M.lengthAttr(e,t,r)}static valueOfMargin(e){return M.lengthAttr(e,"w")}static valueOfBorder(e){let t=ot.parseBorderType(M.attr(e,"val"));if("none"==t)return"none";let r=lt.colorAttr(e,"color");return`${M.lengthAttr(e,"sz",v)} ${t} ${"auto"==r?et:r}`}static parseBorderType(e){switch(e){case"single":case"dashDotStroked":case"thick":case"thickThinLargeGap":case"thickThinMediumGap":case"thickThinSmallGap":case"thinThickLargeGap":case"thinThickMediumGap":case"thinThickSmallGap":case"thinThickThinLargeGap":case"thinThickThinMediumGap":case"thinThickThinSmallGap":case"threeDEmboss":case"threeDEngrave":case"wave":return"solid";case"dashed":case"dashSmallGap":return"dashed";case"dotDash":case"dotDotDash":case"dotted":return"dotted";case"double":case"doubleWave":case"triple":return"double";case"inset":return"inset";case"nil":case"none":return"none";case"outset":return"outset"}return"solid"}static valueOfTblLayout(e){return"fixed"==M.attr(e,"type")?"fixed":"auto"}static classNameOfCnfStyle(e){const t=M.attr(e,"val");return["first-row","last-row","first-col","last-col","odd-col","even-col","odd-row","even-row","ne-cell","nw-cell","se-cell","sw-cell"].filter((e,r)=>"1"==t[r]).join(" ")}static valueOfJc(e){let t=M.attr(e,"val");switch(t){case"start":case"left":return"left";case"center":return"center";case"end":case"right":return"right";case"both":return"justify"}return t}static valueOfVertAlign(e,t=!1){let r=M.attr(e,"val");switch(r){case"subscript":return"sub";case"superscript":return t?"sup":"super"}return t?null:r}static valueOfTextAlignment(e){let t=M.attr(e,"val");switch(t){case"auto":case"baseline":return"baseline";case"top":return"top";case"center":return"middle";case"bottom":return"bottom"}return t}static addSize(e,t){return null==e?t:null==t?e:`calc(${e} + ${t})`}static classNameOftblLook(e){const t=M.hexAttr(e,"val",0);let r="";return(M.boolAttr(e,"firstRow")||32&t)&&(r+=" first-row"),(M.boolAttr(e,"lastRow")||64&t)&&(r+=" last-row"),(M.boolAttr(e,"firstColumn")||128&t)&&(r+=" first-col"),(M.boolAttr(e,"lastColumn")||256&t)&&(r+=" last-col"),(M.boolAttr(e,"noHBand")||512&t)&&(r+=" no-hband"),(M.boolAttr(e,"noVBand")||1024&t)&&(r+=" no-vband"),r.trim()}}const ct={position:0,leader:"none",style:"left"};function dt(e=document.body){const t=document.createElement("div");t.style.width="100pt",e.appendChild(t);const r=100/t.offsetWidth;return e.removeChild(t),r}function pt(e,t,r,n=.75){const a=e.closest("p"),s=e.getBoundingClientRect(),i=a.getBoundingClientRect(),l=getComputedStyle(a),o=(null==t?void 0:t.length)>0?t.sort((e,t)=>e.position-t.position):[ct],c=o[o.length-1],d=i.width*n,p=parseFloat(r);let h=c.position+p;if(h<d)for(;h<d&&o.length<50;h+=p)o.push(Object.assign(Object.assign({},ct),{position:h}));const u=parseFloat(l.marginLeft),m=i.left+u,f=(s.left-m)*n,g=o.find(e=>"clear"!=e.style&&e.position>f);if(null==g)return;let b=1;if("right"==g.style||"center"==g.style){const t=Array.from(a.querySelectorAll(`.${e.className}`)),r=t.indexOf(e)+1,s=document.createRange();s.setStartBefore(e),r<t.length?s.setEndBefore(t[r]):s.setEndAfter(a);const l="center"===g.style?.5:1,o=s.getBoundingClientRect(),c=o.left+l*o.width-(i.left-u);b=g.position-c*n}else b=g.position-f;switch(e.innerHTML="&nbsp;",e.style.textDecoration="inherit",e.style.wordSpacing=`${b.toFixed(0)}pt`,g.leader){case"dot":case"middleDot":e.style.textDecorationLine="underline",e.style.textDecorationStyle="dotted";break;case"hyphen":e.style.textDecorationLine="underline",e.style.textDecorationStyle="dashed";break;case"heavy":case"underscore":e.style.textDecorationLine="underline",e.style.textDecorationStyle="solid";break;default:e.style.textDecorationLine="none"}}class ht{constructor({sectProps:e,children:t=[],stack:r=[],isSplit:n=!1,isFirstPage:a=!1,isLastPage:s=!1,breakIndex:i=new Set,contentElement:l,checkingOverflow:o=!1}){this.type=X.Page,this.level=1,this.pageId=O(),this.sectProps=e,this.children=t,this.stack=r,this.isSplit=n,this.isFirstPage=a,this.isLastPage=s,this.breakIndex=i,this.contentElement=l,this.checkingOverflow=o}}const ut="http://www.w3.org/2000/svg",mt="http://www.w3.org/1998/Math/MathML";var ft;!function(e){e.TRUE="true",e.FALSE="false",e.UNKNOWN="undetected"}(ft||(ft={}));class gt{constructor(){this.className="docx",this.styleMap={},this.currentPart=null,this.tableVerticalMerges=[],this.currentVerticalMerge=null,this.tableCellPositions=[],this.currentCellPosition=null,this.footnoteMap={},this.endnoteMap={},this.currentEndnoteIds=[],this.usedHederFooterParts=[],this.currentTabs=[],this.tabsTimeout=0,this.commentMap={},this.tasks=[],this.postRenderTasks=[]}later(e){this.postRenderTasks.push(e)}render(e,t){return i(this,arguments,void 0,function*(e,t,r=null,n){var a;this.document=e,this.options=n,this.className=n.className,this.rootSelector=n.inWrapper?`.${this.className}-wrapper`:":root",this.styleMap=null,this.wrapper=t,r=r||t,this.options.renderComments&&globalThis.Highlight&&(this.commentHighlight=new Highlight),kt(r),kt(t),St(r,"docxjs library predefined styles"),r.appendChild(this.renderDefaultStyle()),e.themePart&&(St(r,"docxjs document theme values"),this.renderTheme(e.themePart,r)),null!=e.stylesPart&&(this.styleMap=this.processStyles(e.stylesPart.styles),St(r,"docxjs document styles"),r.appendChild(this.renderStyles(e.stylesPart.styles))),e.numberingPart&&(this.processNumberings(e.numberingPart.domNumberings),St(r,"docxjs document numbering styles"),r.appendChild(this.renderNumbering(e.numberingPart.domNumberings,r))),!n.ignoreFonts&&e.fontTablePart&&this.renderFontTable(e.fontTablePart,r),e.footnotesPart&&(this.footnoteMap=s.keyBy(e.footnotesPart.rootElement.children,"id")),e.endnotesPart&&(this.endnoteMap=s.keyBy(e.endnotesPart.rootElement.children,"id")),e.settingsPart&&(this.defaultTabSize=null===(a=e.settingsPart.settings)||void 0===a?void 0:a.defaultTabStop);let i=this.renderPages(e.documentPart.body);this.options.inWrapper?t.appendChild(this.renderWrapper(i)):xt(t,i),this.commentHighlight&&n.renderComments&&CSS.highlights.set(`${this.className}-comments`,this.commentHighlight),this.postRenderTasks.forEach(e=>e()),this.refreshTabStops()})}renderDefaultStyle(){let e=this.className,t=`\n\t\t\t.${e}-wrapper { background: gray; padding: 30px; padding-bottom: 0px; display: flex; flex-flow: column; align-items: center; } \n\t\t\t.${e}-wrapper>section.${e} { background: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); margin-bottom: 30px; }\n\t\t\t.${e} { color: black; hyphens: auto; text-underline-position: from-font; }\n\t\t\tsection.${e} { box-sizing: border-box; display: flex; flex-flow: column nowrap; position: relative; overflow: hidden; }\n            section.${e}>header { position: absolute; top: 0; z-index: 1; display: flex; align-items: flex-end; }\n\t\t\tsection.${e}>article { z-index: 1; }\n\t\t\tsection.${e}>footer { position: absolute; bottom: 0; z-index: 1; }\n\t\t\t.${e} table { border-collapse: collapse; }\n\t\t\t.${e} table td, .${e} table th { vertical-align: top; }\n\t\t\t.${e} p { margin: 0pt; min-height: 1em; }\n\t\t\t.${e} span { white-space: pre-wrap; overflow-wrap: break-word; }\n\t\t\t.${e} a { color: inherit; text-decoration: inherit; }\n\t\t\t.${e} img, ${e} svg { vertical-align: baseline; }\n\t\t\t.${e} .clearfix::after { content: ""; display: block; line-height: 0; clear: both; }\n\t\t`;return this.options.renderComments&&(t+=`\n.${e}-comment-ref { cursor: default; }\n.${e}-comment-popover { display: none; z-index: 1000; padding: 0.5rem; background: white; position: absolute; box-shadow: 0 0 0.25rem rgba(0, 0, 0, 0.25); width: 30ch; }\n.${e}-comment-ref:hover~.${e}-comment-popover { display: block; }\n.${e}-comment-author,.${e}-comment-date { font-size: 0.875rem; color: #888; }\n`),wt(t)}renderTheme(e,t){var r,n;const a={},s=null===(r=e.theme)||void 0===r?void 0:r.fontScheme;s&&(s.majorFont&&(a["--docx-majorHAnsi-font"]=s.majorFont.latinTypeface),s.minorFont&&(a["--docx-minorHAnsi-font"]=s.minorFont.latinTypeface));const i=null===(n=e.theme)||void 0===n?void 0:n.colorScheme;if(i)for(let[e,t]of Object.entries(i.colors))a[`--docx-${e}-color`]=`#${t}`;const l=this.styleToString(`.${this.className}`,a);t.appendChild(wt(l))}processStyleName(e){return e?`${this.className}_${F(e)}`:this.className}processStyles(e){const t=s.keyBy(e.filter(e=>null!=e.id),"id");for(const r of e.filter(e=>e.basedOn)){let e=t[r.basedOn];if(e){r.paragraphProps=s.merge(r.paragraphProps,e.paragraphProps),r.runProps=s.merge(r.runProps,e.runProps);for(const t of e.rulesets){const e=r.rulesets.find(e=>e.target==t.target);e?this.copyStyleProperties(t.declarations,e.declarations):r.rulesets.push(Object.assign(Object.assign({},t),{declarations:Object.assign({},t.declarations)}))}}else this.options.debug&&console.warn(`Can't find base style ${r.basedOn}`)}for(let t of e)t.cssName=this.processStyleName(t.id);return t}renderStyles(e){var t;let r="";const n=this.styleMap,a=s.keyBy(e.filter(e=>e.isDefault),"target");for(const s of e){let e=s.rulesets;if(s.linked){let t=s.linked&&n[s.linked];t?e=e.concat(t.rulesets):this.options.debug&&console.warn(`Can't find linked style ${s.linked}`)}for(const n of e){let e=`${null!==(t=s.type)&&void 0!==t?t:""}.${s.cssName}`;s.type!=n.target&&(e+=` ${n.target}`),a[s.type]==s&&(e=`.${this.className} ${s.type}, `+e),r+=this.styleToString(e,n.declarations)}}return wt(r)}processNumberings(e){var t;for(let r of e.filter(e=>e.pStyleName)){const e=this.findStyle(r.pStyleName);(null===(t=null==e?void 0:e.paragraphProps)||void 0===t?void 0:t.numbering)&&(e.paragraphProps.numbering.level=r.level)}}renderNumbering(e,t){let r="",n=[];for(let a of e){let e=`p.${this.numberingClass(a.id,a.level)}`,s="none";if(a.bullet){let n=`--${this.className}-${a.bullet.src}`.toLowerCase();r+=this.styleToString(`${e}:before`,{content:"' '",display:"inline-block",background:`var(${n})`},a.bullet.style),this.document.loadNumberingImage(a.bullet.src).then(e=>{let r=`${this.rootSelector} { ${n}: url(${e}) }`;t.appendChild(wt(r))})}else if(a.levelText){let t=this.numberingCounter(a.id,a.level);const s=t+" "+(a.start-1);a.level>0&&(r+=this.styleToString(`p.${this.numberingClass(a.id,a.level-1)}`,{"counter-set":s})),n.push(s),r+=this.styleToString(`${e}:before`,Object.assign({content:this.levelTextToContent(a.levelText,a.suff,a.id,this.numFormatToCssValue(a.format)),"counter-increment":t},a.rStyle))}else s=this.numFormatToCssValue(a.format);r+=this.styleToString(e,Object.assign({display:"list-item","list-style-position":"inside","list-style-type":s},a.pStyle))}return n.length>0&&(r+=this.styleToString(this.rootSelector,{"counter-reset":n.join(" ")})),wt(r)}numberingClass(e,t){return`${this.className}-num-${e}-${t}`}styleToString(e,t,r=null){let n=`${e} {\r\n`;for(const e in t)e.startsWith("$")||(n+=`  ${e}: ${t[e]};\r\n`);return r&&(n+=r),n+"}\r\n"}numberingCounter(e,t){return`${this.className}-num-${e}-${t}`}levelTextToContent(e,t,r,n){var a;return`"${e.replace(/%\d*/g,e=>{let t=parseInt(e.substring(1),10)-1;return`"counter(${this.numberingCounter(r,t)}, ${n})"`})}${null!==(a={tab:"\\9",space:"\\a0"}[t])&&void 0!==a?a:""}"`}numFormatToCssValue(e){var t;return null!==(t={none:"none",bullet:"disc",decimal:"decimal",lowerLetter:"lower-alpha",upperLetter:"upper-alpha",lowerRoman:"lower-roman",upperRoman:"upper-roman",decimalZero:"decimal-leading-zero",aiueo:"katakana",aiueoFullWidth:"katakana",chineseCounting:"simp-chinese-informal",chineseCountingThousand:"simp-chinese-informal",chineseLegalSimplified:"simp-chinese-formal",chosung:"hangul-consonant",ideographDigital:"cjk-ideographic",ideographTraditional:"cjk-heavenly-stem",ideographLegalTraditional:"trad-chinese-formal",ideographZodiac:"cjk-earthly-branch",iroha:"katakana-iroha",irohaFullWidth:"katakana-iroha",japaneseCounting:"japanese-informal",japaneseDigitalTenThousand:"cjk-decimal",japaneseLegal:"japanese-formal",thaiNumbers:"thai",koreanCounting:"korean-hangul-formal",koreanDigital:"korean-hangul-formal",koreanDigital2:"korean-hanja-informal",hebrew1:"hebrew",hebrew2:"hebrew",hindiNumbers:"devanagari",ganada:"hangul",taiwaneseCounting:"cjk-ideographic",taiwaneseCountingThousand:"cjk-ideographic",taiwaneseDigital:"cjk-decimal"}[e])&&void 0!==t?t:e}renderFontTable(e,t){for(let r of e.fonts)for(let e of r.embedFontRefs)this.document.loadFont(e.id,e.key).then(n=>{const a={"font-family":r.name,src:`url(${n})`};"bold"!=e.type&&"boldItalic"!=e.type||(a["font-weight"]="bold"),"italic"!=e.type&&"boldItalic"!=e.type||(a["font-style"]="italic"),St(t,`docxjs ${r.name} font`);const s=this.styleToString("@font-face",a);t.appendChild(wt(s)),this.refreshTabStops()})}renderWrapper(e){return bt("div",{className:`${this.className}-wrapper`},e)}copyStyleProperties(e,t,r=null){if(!e)return t;null==t&&(t={}),null==r&&(r=Object.getOwnPropertyNames(e));for(let n of r)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n]);return t}processElement(e){if(e.children)for(let t of e.children)t.parent=e,t.type==X.Table?this.processTable(t):this.processElement(t)}processTable(e){for(let t of e.children)for(let r of t.children)r.cssStyle=this.copyStyleProperties(e.cellStyle,r.cssStyle,["border-left","border-right","border-top","border-bottom","padding-left","padding-right","padding-top","padding-bottom"]),this.processElement(r)}splitPage(e){var t;let r=new ht({});const n=[r];for(const a of e){if(a.level=1,r.children.push(a),a.type==X.Paragraph){const e=a,s=e.props.sectionProperties;s&&(s.sectionId=O());const i=this.findStyle(e.styleName);(null===(t=null==i?void 0:i.paragraphProps)||void 0===t?void 0:t.pageBreakBefore)&&(r.isSplit=!0,r.sectProps=s,r=new ht({}),n.push(r));let l=-1,o=-1;if(e.children&&(l=e.children.findIndex(e=>{var t;return o=null===(t=e.children)||void 0===t?void 0:t.findIndex(e=>(e.type===X.Break||e.type===X.LastRenderedPageBreak)&&(e.type===X.LastRenderedPageBreak?r.children.length>2||!this.options.ignoreLastRenderedPageBreak:"page"===e.break||void 0)),o=null!=o?o:-1,-1!=o})),-1!=l){r.isSplit=!0;const e=r.children.some(e=>e.type===X.Table);e&&(r.isSplit=!1);let t=r.children.some(e=>e.children.some(e=>{var t;return e.type===X.Hyperlink&&(null===(t=null==e?void 0:e.href)||void 0===t?void 0:t.includes("Toc"))}));t&&(r.isSplit=!1)}if((-1!=l||s&&s.type!=U.Continuous&&s.type!=U.NextColumn)&&(r.sectProps=s,r=new ht({}),n.push(r)),-1!=l){let t=e.children[l],n=o<t.children.length-1;if(l<e.children.length-1||n){let a=e.children;const s=Object.assign(Object.assign({},e),{children:a.slice(l)});if(e.children=a.slice(0,l),r.children.push(s),n){const r=t.children,n=Object.assign(Object.assign({},t),{children:r.slice(0,o)});e.children.push(n),t.children=r.slice(o)}}}}a.type===X.Table&&(r.isSplit=!1)}let a=null;for(let e=n.length-1;e>=0;e--)null==n[e].sectProps?n[e].sectProps=a:a=n[e].sectProps;return n}renderPages(e){const t=[];let r;this.processElement(e),r=this.options.breakPages?this.splitPage(e.children):[new ht({sectProps:e.sectProps,children:e.children})],e.pages=r;let n=null;for(let a=0,s=r.length;a<s;a++){this.currentFootnoteIds=[];const i=r[a],{sectProps:l}=i;let o=null!=l?l:e.sectProps,c=t.length,d=n!=o,p=a===s-1,h=this.renderPage(i,o,e.cssStyle,c,d,p);t.push(...h),n=l}return t}renderPage(e,t,r,n,a,s){const i=this.createPage(this.className,t);this.renderStyleValues(r,i),this.options.renderHeaders&&this.renderHeaderFooterRef(t.headerRefs,t,n,a,i);let l=bt("article");return this.options.breakPages&&(l.style.minHeight=t.contentSize.height),this.renderElements(e.children,l),i.appendChild(l),this.options.renderFootnotes&&this.renderNotes(this.currentFootnoteIds,this.footnoteMap,i),this.options.renderEndnotes&&s&&this.renderNotes(this.currentEndnoteIds,this.endnoteMap,i),this.options.renderFooters&&this.renderHeaderFooterRef(t.footerRefs,t,n,a,i),[i]}createPage(e,t){let r=bt("section",{className:e});return t&&(t.pageMargins&&(r.style.paddingLeft=t.pageMargins.left,r.style.paddingRight=t.pageMargins.right,r.style.paddingTop=t.pageMargins.top,r.style.paddingBottom=t.pageMargins.bottom),t.pageSize&&(this.options.ignoreWidth||(r.style.width=t.pageSize.width),this.options.ignoreHeight||(r.style.minHeight=t.pageSize.height)),t.columns&&t.columns.count&&(r.style.columnCount=`${t.columns.count}`,r.style.columnGap=t.columns.space,t.columns.separator&&(r.style.columnRule="1px solid black"))),r}renderHeaderFooterRef(e,t,r,n,a){var s,i,l,o,c,d,p,h;if(!e)return;let u=null!==(i=null!==(s=t.titlePage&&n?e.find(e=>"first"==e.type):null)&&void 0!==s?s:r%2==1?e.find(e=>"even"==e.type):null)&&void 0!==i?i:e.find(e=>"default"==e.type),m=u&&this.document.findPartByRelId(u.id,this.document.documentPart);if(m){switch(this.currentPart=m,this.usedHederFooterParts.includes(m.path)||(this.processElement(m.rootElement),this.usedHederFooterParts.push(m.path)),m.rootElement.type){case X.Header:m.rootElement.cssStyle={left:null===(l=t.pageMargins)||void 0===l?void 0:l.left,width:null===(o=t.contentSize)||void 0===o?void 0:o.width,height:null===(c=t.pageMargins)||void 0===c?void 0:c.top};break;case X.Footer:m.rootElement.cssStyle={left:null===(d=t.pageMargins)||void 0===d?void 0:d.left,width:null===(p=t.contentSize)||void 0===p?void 0:p.width,height:null===(h=t.pageMargins)||void 0===h?void 0:h.bottom};break;default:console.warn("set header/footer style error",m.rootElement.type)}this.renderElements([m.rootElement],a),this.currentPart=null}}renderNotes(e,t,r){let n=e.map(e=>t[e]).filter(e=>e);if(n.length>0){let e=bt("ol",null,this.renderElements(n));r.appendChild(e)}}renderElements(e,t){if(null==e)return null;let r=[];for(let t=0;t<e.length;t++){let n=this.renderElement(e[t]);Array.isArray(n)?r.push(...n):n&&r.push(n)}return t&&xt(t,r),r}renderElement(e){switch(e.type){case X.Paragraph:return this.renderParagraph(e);case X.BookmarkStart:return this.renderBookmarkStart(e);case X.BookmarkEnd:return null;case X.Run:return this.renderRun(e);case X.Table:return this.renderTable(e);case X.Row:return this.renderTableRow(e);case X.Cell:return this.renderTableCell(e);case X.Hyperlink:return this.renderHyperlink(e);case X.Drawing:return this.renderDrawing(e);case X.Image:return this.renderImage(e);case X.Text:return this.renderText(e);case X.DeletedText:return this.renderDeletedText(e);case X.Tab:return this.renderTab(e);case X.Symbol:return this.renderSymbol(e);case X.Break:return this.renderBreak(e);case X.Footer:return this.renderHeaderFooter(e,"footer");case X.Header:return this.renderHeaderFooter(e,"header");case X.Footnote:case X.Endnote:return this.renderContainer(e,"li");case X.FootnoteReference:return this.renderFootnoteReference(e);case X.EndnoteReference:return this.renderEndnoteReference(e);case X.NoBreakHyphen:return bt("wbr");case X.VmlPicture:return this.renderVmlPicture(e);case X.VmlElement:return this.renderVmlElement(e);case X.MmlMath:return this.renderContainerNS(e,mt,"math",{xmlns:mt});case X.MmlMathParagraph:return this.renderContainer(e,"span");case X.MmlFraction:return this.renderContainerNS(e,mt,"mfrac");case X.MmlBase:return this.renderContainerNS(e,mt,e.parent.type==X.MmlMatrixRow?"mtd":"mrow");case X.MmlNumerator:case X.MmlDenominator:case X.MmlFunction:case X.MmlLimit:case X.MmlBox:return this.renderContainerNS(e,mt,"mrow");case X.MmlGroupChar:return this.renderMmlGroupChar(e);case X.MmlLimitLower:return this.renderContainerNS(e,mt,"munder");case X.MmlMatrix:return this.renderContainerNS(e,mt,"mtable");case X.MmlMatrixRow:return this.renderContainerNS(e,mt,"mtr");case X.MmlRadical:return this.renderMmlRadical(e);case X.MmlSuperscript:return this.renderContainerNS(e,mt,"msup");case X.MmlSubscript:return this.renderContainerNS(e,mt,"msub");case X.MmlDegree:case X.MmlSuperArgument:case X.MmlSubArgument:return this.renderContainerNS(e,mt,"mn");case X.MmlFunctionName:return this.renderContainerNS(e,mt,"ms");case X.MmlDelimiter:return this.renderMmlDelimiter(e);case X.MmlRun:return this.renderMmlRun(e);case X.MmlNary:return this.renderMmlNary(e);case X.MmlPreSubSuper:return this.renderMmlPreSubSuper(e);case X.MmlBar:return this.renderMmlBar(e);case X.MmlEquationArray:return this.renderMllList(e);case X.Inserted:return this.renderInserted(e);case X.Deleted:return this.renderDeleted(e);case X.CommentRangeStart:return this.renderCommentRangeStart(e);case X.CommentRangeEnd:return this.renderCommentRangeEnd(e);case X.CommentReference:return this.renderCommentReference(e)}return null}isPageBreakElement(e){return(e.type===X.Break||e.type===X.LastRenderedPageBreak)&&(e.type===X.LastRenderedPageBreak?!this.options.ignoreLastRenderedPageBreak:"page"===e.break||void 0)}renderChildren(e,t){return this.renderElements(e.children,t)}renderContainer(e,t,r){return bt(t,r,this.renderChildren(e))}renderContainerNS(e,t,r,n){return vt(t,r,n,this.renderChildren(e))}renderParagraph(e){var t,r,n,a,s;let i=bt("p");const l=this.findStyle(e.styleName);null!==(t=(s=e.props).tabs)&&void 0!==t||(s.tabs=null===(r=null==l?void 0:l.paragraphProps)||void 0===r?void 0:r.tabs),this.renderClass(e,i),this.renderChildren(e,i),this.renderStyleValues(e.cssStyle,i),this.renderCommonProperties(i.style,e.props);const o=null!==(n=e.props.numbering)&&void 0!==n?n:null===(a=null==l?void 0:l.paragraphProps)||void 0===a?void 0:a.numbering;return o&&i.classList.add(this.numberingClass(o.id,o.level)),i}renderRun(e){if(e.fieldRun)return null;const t=bt("span");if(this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),e.verticalAlign){const r=bt(e.verticalAlign);this.renderChildren(e,r),t.appendChild(r)}else this.renderChildren(e,t);return t}renderText(e){return document.createTextNode(e.text)}renderHyperlink(e){let t=bt("a");if(this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),e.href)t.href=e.href;else if(e.id){const r=this.document.documentPart.rels.find(t=>t.id==e.id&&"External"===t.targetMode);t.href=null==r?void 0:r.target}return t}renderDrawing(e){let t=bt("div");return t.style.display="inline-block",t.style.position="relative",t.style.textIndent="0px",this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),t}renderImage(e){let t=bt("img");return this.renderStyleValues(e.cssStyle,t),this.document&&this.document.loadDocumentImage(e.src,this.currentPart).then(e=>{t.src=e}),t}renderDeletedText(e){return this.options.renderEndnotes?document.createTextNode(e.text):null}renderBreak(e){return"textWrapping"==e.break?bt("br"):null}renderInserted(e){return this.options.renderChanges?this.renderContainer(e,"ins"):this.renderChildren(e)}renderDeleted(e){return this.options.renderChanges?this.renderContainer(e,"del"):null}renderCommentRangeStart(e){var t;if(!this.options.renderComments)return null;const r=new Range;null===(t=this.commentHighlight)||void 0===t||t.add(r);const n=document.createComment(`start of comment #${e.id}`);return this.later(()=>r.setStart(n,0)),this.commentMap[e.id]=r,n}renderCommentRangeEnd(e){if(!this.options.renderComments)return null;const t=this.commentMap[e.id],r=document.createComment(`end of comment #${e.id}`);return this.later(()=>null==t?void 0:t.setEnd(r,0)),r}renderCommentReference(e){var t;if(!this.options.renderComments)return null;var r=null===(t=this.document.commentsPart)||void 0===t?void 0:t.commentMap[e.id];if(!r)return null;const n=new DocumentFragment,a=bt("span",{className:`${this.className}-comment-ref`});a.textContent="💬";const s=bt("div",{className:`${this.className}-comment-popover`});return this.renderCommentContent(r,s),n.appendChild(document.createComment(`comment #${r.id} by ${r.author} on ${r.date}`)),n.appendChild(a),n.appendChild(s),n}renderCommentContent(e,t){t.appendChild(bt("div",{className:`${this.className}-comment-author`},[e.author])),t.appendChild(bt("div",{className:`${this.className}-comment-date`},[new Date(e.date).toLocaleString()])),this.renderElements(e.children,t)}renderSymbol(e){let t=bt("span");return t.style.fontFamily=e.font,t.innerHTML=`&#x${e.char};`,t}renderHeaderFooter(e,t){let r=bt(t);return this.renderChildren(e,r),this.renderStyleValues(e.cssStyle,r),r}renderFootnoteReference(e){let t=bt("sup");return this.currentFootnoteIds.push(e.id),t.textContent=`${this.currentFootnoteIds.length}`,t}renderEndnoteReference(e){let t=bt("sup");return this.currentEndnoteIds.push(e.id),t.textContent=`${this.currentEndnoteIds.length}`,t}renderTab(e){var t;let r=bt("span");if(r.innerHTML="&emsp;",this.options.experimental){r.className=this.tabStopClass();let n=null===(t=function(e,t){let r=e.parent;for(;null!=r&&r.type!=t;)r=r.parent;return r}(e,X.Paragraph).props)||void 0===t?void 0:t.tabs;this.currentTabs.push({stops:n,span:r})}return r}renderBookmarkStart(e){let t=bt("span");return t.id=e.name,t}renderTable(e){let t=bt("table");return this.tableCellPositions.push(this.currentCellPosition),this.tableVerticalMerges.push(this.currentVerticalMerge),this.currentVerticalMerge={},this.currentCellPosition={col:0,row:0},e.columns&&t.appendChild(this.renderTableColumns(e.columns)),this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),this.currentVerticalMerge=this.tableVerticalMerges.pop(),this.currentCellPosition=this.tableCellPositions.pop(),t}renderTableColumns(e){let t=bt("colgroup");for(let r of e){let e=bt("col");r.width&&(e.style.width=r.width),t.appendChild(e)}return t}renderTableRow(e){let t=bt("tr");return this.currentCellPosition.col=0,this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),this.currentCellPosition.row++,t}renderTableCell(e){let t=bt("td");const r=this.currentCellPosition.col;return e.verticalMerge?"restart"==e.verticalMerge?(this.currentVerticalMerge[r]=t,t.rowSpan=1):this.currentVerticalMerge[r]&&(this.currentVerticalMerge[r].rowSpan+=1,t.style.display="none"):this.currentVerticalMerge[r]=null,this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),e.span&&(t.colSpan=e.span),this.currentCellPosition.col+=t.colSpan,t}renderVmlPicture(e){let t=bt("div");return this.renderChildren(e,t),t}renderVmlElement(e){var t,r;let n=yt("svg");n.setAttribute("style",e.cssStyleText);const a=this.renderVmlChildElement(e);return(null===(t=e.imageHref)||void 0===t?void 0:t.id)&&(null===(r=this.document)||void 0===r||r.loadDocumentImage(e.imageHref.id,this.currentPart).then(e=>a.setAttribute("href",e))),n.appendChild(a),requestAnimationFrame(()=>{const e=n.firstElementChild.getBBox();n.setAttribute("width",`${Math.ceil(e.x+e.width)}`),n.setAttribute("height",`${Math.ceil(e.y+e.height)}`)}),n}renderVmlChildElement(e){const t=yt(e.tagName);Object.entries(e.attrs).forEach(([e,r])=>t.setAttribute(e,r));for(let r of e.children)r.type==X.VmlElement?t.appendChild(this.renderVmlChildElement(r)):t.append(...L(this.renderElement(r)));return t}renderMmlRadical(e){var t;const r=e.children.find(e=>e.type==X.MmlBase);if(null===(t=e.props)||void 0===t?void 0:t.hideDegree)return vt(mt,"msqrt",null,this.renderElements([r]));const n=e.children.find(e=>e.type==X.MmlDegree);return vt(mt,"mroot",null,this.renderElements([r,n]))}renderMmlDelimiter(e){var t,r;const n=[];return n.push(vt(mt,"mo",null,[null!==(t=e.props.beginChar)&&void 0!==t?t:"("])),n.push(...this.renderElements(e.children)),n.push(vt(mt,"mo",null,[null!==(r=e.props.endChar)&&void 0!==r?r:")"])),vt(mt,"mrow",null,n)}renderMmlNary(e){var t,r;const n=[],a=s.keyBy(e.children,"type"),i=a[X.MmlSuperArgument],l=a[X.MmlSubArgument],o=i?vt(mt,"mo",null,L(this.renderElement(i))):null,c=l?vt(mt,"mo",null,L(this.renderElement(l))):null,d=vt(mt,"mo",null,[null!==(r=null===(t=e.props)||void 0===t?void 0:t.char)&&void 0!==r?r:"∫"]);return o||c?n.push(vt(mt,"munderover",null,[d,c,o])):o?n.push(vt(mt,"mover",null,[d,o])):c?n.push(vt(mt,"munder",null,[d,c])):n.push(d),n.push(...this.renderElements(a[X.MmlBase].children)),vt(mt,"mrow",null,n)}renderMmlPreSubSuper(e){const t=[],r=s.keyBy(e.children,"type"),n=r[X.MmlSuperArgument],a=r[X.MmlSubArgument],i=n?vt(mt,"mo",null,L(this.renderElement(n))):null,l=a?vt(mt,"mo",null,L(this.renderElement(a))):null,o=vt(mt,"mo",null);return t.push(vt(mt,"msubsup",null,[o,l,i])),t.push(...this.renderElements(r[X.MmlBase].children)),vt(mt,"mrow",null,t)}renderMmlGroupChar(e){const t="bot"===e.props.verticalJustification?"mover":"munder",r=this.renderContainerNS(e,mt,t);return e.props.char&&r.appendChild(vt(mt,"mo",null,[e.props.char])),r}renderMmlBar(e){const t=this.renderContainerNS(e,mt,"mrow");switch(e.props.position){case"top":t.style.textDecoration="overline";break;case"bottom":t.style.textDecoration="underline"}return t}renderMmlRun(e){const t=vt(mt,"ms");return this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),this.renderChildren(e,t),t}renderMllList(e){const t=vt(mt,"mtable");this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t);const r=this.renderChildren(e);for(let e of r)t.appendChild(vt(mt,"mtr",null,[vt(mt,"mtd",null,[e])]));return t}renderStyleValues(e,t){for(let r in e)r.startsWith("$")?t.setAttribute(r.slice(1),e[r]):t.style[r]=e[r]}renderRunProperties(e,t){this.renderCommonProperties(e,t)}renderCommonProperties(e,t){null!=t&&(t.color&&(e.color=t.color),t.fontSize&&(e["font-size"]=t.fontSize))}renderClass(e,t){e.className&&(t.className=e.className),e.styleName&&t.classList.add(this.processStyleName(e.styleName))}findStyle(e){var t;return e&&(null===(t=this.styleMap)||void 0===t?void 0:t[e])}tabStopClass(){return`${this.className}-tab-stop`}refreshTabStops(){this.options.experimental&&(clearTimeout(this.tabsTimeout),this.tabsTimeout=setTimeout(()=>{const e=dt();for(let t of this.currentTabs)pt(t.span,t.stops,this.defaultTabSize,e)},500))}}function bt(e,t,r){return vt(void 0,e,t,r)}function yt(e,t,r){return vt(ut,e,t,r)}function vt(e,t,r,n){let a=e?document.createElementNS(e,t):document.createElement(t);return Object.assign(a,r),n&&xt(a,n),a}function kt(e){e.innerHTML=""}function xt(e,t){t.forEach(t=>{e.appendChild(s.isString(t)?document.createTextNode(t):t)})}function wt(e){return bt("style",{innerHTML:e})}function St(e,t){e.appendChild(document.createComment(t))}const Ct="http://www.w3.org/2000/svg",Pt="http://www.w3.org/1998/Math/MathML";var Nt;!function(e){e.TRUE="true",e.FALSE="false",e.SELF="self",e.FULL="full",e.PART="part",e.UNKNOWN="undetected",e.IGNORE="ignore"}(Nt||(Nt={}));class Tt{constructor(){this.className="docx",this.styleMap={},this.currentPart=null,this.tableVerticalMerges=[],this.currentVerticalMerge=null,this.tableCellPositions=[],this.currentCellPosition=null,this.footnoteMap={},this.endnoteMap={},this.currentEndnoteIds=[],this.usedHeaderFooterParts=[],this.currentTabs=[],this.commentMap={},this.postRenderTasks=[]}later(e){this.postRenderTasks.push(e)}render(e,t){return i(this,arguments,void 0,function*(e,t,r=null,n){var a;this.document=e,this.options=n,this.className=n.className,this.rootSelector=n.inWrapper?`.${this.className}-wrapper`:":root",this.styleMap=null,this.options.renderComments&&globalThis.Highlight&&(this.commentHighlight=new Highlight),this.bodyContainer=t,r=r||t,this.pointToPixelRatio=dt(),Rt(r),Rt(t),Bt(r,"docxjs library predefined styles"),r.appendChild(this.renderDefaultStyle()),e.themePart&&(Bt(r,"docxjs document theme values"),this.renderTheme(e.themePart,r)),null!=e.stylesPart&&(this.styleMap=this.processStyles(e.stylesPart.styles),Bt(r,"docxjs document styles"),r.appendChild(this.renderStyles(e.stylesPart.styles))),e.numberingPart&&(this.processNumberings(e.numberingPart.domNumberings),Bt(r,"docxjs document numbering styles"),r.appendChild(this.renderNumbering(e.numberingPart.domNumberings,r))),!n.ignoreFonts&&e.fontTablePart&&this.renderFontTable(e.fontTablePart,r),e.footnotesPart&&(this.footnoteMap=s.keyBy(e.footnotesPart.rootElement.children,"id")),e.endnotesPart&&(this.endnoteMap=s.keyBy(e.endnotesPart.rootElement.children,"id")),e.settingsPart&&(this.defaultTabSize=null===(a=e.settingsPart.settings)||void 0===a?void 0:a.defaultTabStop),this.options.inWrapper?(this.wrapper=this.renderWrapper(),t.appendChild(this.wrapper)):this.wrapper=t,this.renderKonva(),yield this.renderPages(e.documentPart.body),this.konva_stage.visible(!1),this.refreshTabStops(),this.commentHighlight&&n.renderComments&&CSS.highlights.set(`${this.className}-comments`,this.commentHighlight),this.postRenderTasks.forEach(e=>e())})}renderDefaultStyle(){const e=this.className;let t=`\n\t\t\t.${e} { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif }\n\t\t\t.${e}-wrapper { background: gray; padding: 30px; padding-bottom: 0px; display: flex; flex-flow: column; align-items: center; line-height:normal; font-weight:normal; } \n\t\t\t.${e}-wrapper>section.${e} { background: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); margin-bottom: 30px; }\n\t\t\t.${e} { color: black; hyphens: auto; text-underline-position: from-font; }\n\t\t\tsection.${e} { box-sizing: border-box; display: flex; flex-flow: column nowrap; position: relative; overflow: hidden; }\n            section.${e}>header { position: absolute; top: 0; z-index: 1; display: flex; flex-direction: column; justify-content: flex-end; }\n\t\t\tsection.${e}>article { z-index: 1; }\n\t\t\tsection.${e}>footer { position: absolute; bottom: 0; z-index: 1; }\n\t\t\t.${e} table { border-collapse: collapse; }\n\t\t\t.${e} table td, .${e} table th { vertical-align: top; }\n\t\t\t.${e} p { margin: 0pt; min-height: 1em; }\n\t\t\t.${e} span { white-space: pre-wrap; overflow-wrap: break-word; }\n\t\t\t.${e} a { color: inherit; text-decoration: inherit; }\n\t\t\t.${e} img, ${e} svg { vertical-align: baseline; }\n\t\t\t.${e} svg { fill: transparent; }\n\t\t\t.${e} .clearfix::after { content: ""; display: block; line-height: 0; clear: both; }\n\t\t`;return this.options.renderComments&&(t+=`\n.${e}-comment-ref { cursor: default; }\n.${e}-comment-popover { display: none; z-index: 1000; padding: 0.5rem; background: white; position: absolute; box-shadow: 0 0 0.25rem rgba(0, 0, 0, 0.25); width: 30ch; }\n.${e}-comment-ref:hover~.${e}-comment-popover { display: block; }\n.${e}-comment-author,.${e}-comment-date { font-size: 0.875rem; color: #888; }\n`),Ft(t)}renderTheme(e,t){var r,n;const a={},s=null===(r=e.theme)||void 0===r?void 0:r.fontScheme;s&&(s.majorFont&&(a["--docx-majorHAnsi-font"]=s.majorFont.latinTypeface),s.minorFont&&(a["--docx-minorHAnsi-font"]=s.minorFont.latinTypeface));const i=null===(n=e.theme)||void 0===n?void 0:n.colorScheme;if(i)for(const[e,t]of Object.entries(i.colors))a[`--docx-${e}-color`]=`#${t}`;const l=this.styleToString(`.${this.className}`,a);t.appendChild(Ft(l))}processStyleName(e){return e?`${this.className}_${F(e)}`:this.className}processStyles(e){let t=s.keyBy(e,"id");for(const r of e){if(r.cssName=this.processStyleName(r.id),null===r.basedOn)continue;const e=t[r.basedOn];if(e){(null==e?void 0:e.paragraphProps)&&(r.paragraphProps=s.merge({},null==e?void 0:e.paragraphProps,r.paragraphProps)),(null==e?void 0:e.runProps)&&(r.runProps=s.merge({},null==e?void 0:e.runProps,r.runProps));for(let t of e.rulesets){let e=r.rulesets.find(e=>e.target==t.target);e?e.declarations=s.merge({},t.declarations,e.declarations):r.rulesets.push(Object.assign({},t))}}else this.options.debug&&console.warn(`Can't find base style ${r.basedOn}`)}return t}renderStyles(e){var t;let r="";for(const n of e)for(const e of n.rulesets){let a=`${null!==(t=n.label)&&void 0!==t?t:""}.${n.cssName}`;n.label!==e.target&&(a+=` ${e.target}`),n.isDefault&&(a=`.${this.className} ${n.label}, `+a),r+=this.styleToString(a,e.declarations)}return Ft(r)}processNumberings(e){var t;for(const r of e.filter(e=>e.pStyleName)){const e=this.findStyle(r.pStyleName);(null===(t=null==e?void 0:e.paragraphProps)||void 0===t?void 0:t.numbering)&&(e.paragraphProps.numbering.level=r.level)}}renderNumbering(e,t){let r="";const n=[];for(const a of e){const e=`p.${this.numberingClass(a.id,a.level)}`;let s="none";if(a.bullet){const n=`--${this.className}-${a.bullet.src}`.toLowerCase();r+=this.styleToString(`${e}:before`,{content:"' '",display:"inline-block",background:`var(${n})`},a.bullet.style),this.document.loadNumberingImage(a.bullet.src).then(e=>{const r=`${this.rootSelector} { ${n}: url(${e}) }`;t.appendChild(Ft(r))})}else if(a.levelText){const t=this.numberingCounter(a.id,a.level),s=t+" "+(a.start-1);a.level>0&&(r+=this.styleToString(`p.${this.numberingClass(a.id,a.level-1)}`,{"counter-reset":s})),n.push(s),r+=this.styleToString(`${e}:before`,Object.assign({content:this.levelTextToContent(a.levelText,a.suff,a.id,this.numFormatToCssValue(a.format)),"counter-increment":t},a.rStyle))}else s=this.numFormatToCssValue(a.format);r+=this.styleToString(e,Object.assign({display:"list-item","list-style-position":"inside","list-style-type":s},a.pStyle))}return n.length>0&&(r+=this.styleToString(this.rootSelector,{"counter-reset":n.join(" ")})),Ft(r)}numberingClass(e,t){return`${this.className}-num-${e}-${t}`}styleToString(e,t,r=null){let n=`${e} {\r\n`;for(const e in t)e.startsWith("$")||(n+=`  ${e}: ${t[e]};\r\n`);return r&&(n+=r),n+"}\r\n"}numberingCounter(e,t){return`${this.className}-num-${e}-${t}`}levelTextToContent(e,t,r,n){var a;return`"${e.replace(/%\d*/g,e=>{const t=parseInt(e.substring(1),10)-1;return`"counter(${this.numberingCounter(r,t)}, ${n})"`})}${null!==(a={tab:"\\9",space:"\\a0"}[t])&&void 0!==a?a:""}"`}numFormatToCssValue(e){var t;return null!==(t={none:"none",bullet:"disc",decimal:"decimal",lowerLetter:"lower-alpha",upperLetter:"upper-alpha",lowerRoman:"lower-roman",upperRoman:"upper-roman",decimalZero:"decimal-leading-zero",aiueo:"katakana",aiueoFullWidth:"katakana",chineseCounting:"simp-chinese-informal",chineseCountingThousand:"simp-chinese-informal",chineseLegalSimplified:"simp-chinese-formal",chosung:"hangul-consonant",ideographDigital:"cjk-ideographic",ideographTraditional:"cjk-heavenly-stem",ideographLegalTraditional:"trad-chinese-formal",ideographZodiac:"cjk-earthly-branch",iroha:"katakana-iroha",irohaFullWidth:"katakana-iroha",japaneseCounting:"japanese-informal",japaneseDigitalTenThousand:"cjk-decimal",japaneseLegal:"japanese-formal",thaiNumbers:"thai",koreanCounting:"korean-hangul-formal",koreanDigital:"korean-hangul-formal",koreanDigital2:"korean-hanja-informal",hebrew1:"hebrew",hebrew2:"hebrew",hindiNumbers:"devanagari",ganada:"hangul",taiwaneseCounting:"cjk-ideographic",taiwaneseCountingThousand:"cjk-ideographic",taiwaneseDigital:"cjk-decimal"}[e])&&void 0!==t?t:e}renderFontTable(e,t){for(const r of e.fonts)for(const e of r.embedFontRefs)this.document.loadFont(e.id,e.key).then(n=>{const a={"font-family":r.name,src:`url(${n})`};"bold"!=e.type&&"boldItalic"!=e.type||(a["font-weight"]="bold"),"italic"!=e.type&&"boldItalic"!=e.type||(a["font-style"]="italic"),Bt(t,`docxjs ${r.name} font`);const s=this.styleToString("@font-face",a);t.appendChild(Ft(s)),this.refreshTabStops()})}renderWrapper(){return Mt("div",{className:`${this.className}-wrapper`})}copyStyleProperties(e,t,r=null){if(!e)return t;null==t&&(t={}),null==r&&(r=Object.getOwnPropertyNames(e));for(const n of r)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n]);return t}processElement(e){if(e.children)for(const t of e.children)t.parent=e,t.level=(null==e?void 0:e.level)+1,t.type==X.Table?(this.processTable(t),this.processElement(t)):this.processElement(t)}processTable(e){for(const t of e.children)for(const r of t.children)r.cssStyle=this.copyStyleProperties(e.cellStyle,r.cssStyle,["border-left","border-right","border-top","border-bottom","padding-left","padding-right","padding-top","padding-bottom"])}splitPageBySymbol(e){var t,r,n;let a=s.cloneDeep(e),i=new ht({isSplit:!0}),l=[];function o(){i.children.length>0&&(l.push(i),i=new ht({isSplit:!0}))}const c=(e,t)=>{var r,n,l;let c=new Set([X.BookmarkStart]);if(e.type===X.Paragraph){const d=this.findStyle(null==e?void 0:e.styleName);if(null===(r=null==d?void 0:d.paragraphProps)||void 0===r?void 0:r.pageBreakBefore){let h=i.stack.pop();return i.children=m(i.stack),o(),h.prev=null,void(i.stack=[h])}const p=null===(n=e.props)||void 0===n?void 0:n.sectionProperties;if(!1===i.isSplit&&void 0===p)return;i.sectProps=p}if(e.type===X.Table&&i.isSplit&&(i.isSplit=!1),e.type===X.Hyperlink){const u=null===(l=null==e?void 0:e.href)||void 0===l?void 0:l.includes("Toc");i.isSplit&&u&&(i.isSplit=!1)}if(e.type===X.LastRenderedPageBreak){if(!1===i.isSplit)return;let{left:f,removedElementIds:g,ignoredElementIds:b}=k(e),y=t.find(e=>e.type===X.Paragraph),v=i.stack.some(e=>{if(e.parent.uuid===(null==y?void 0:y.uuid)){let t=!1;if(e.prev){!1===c.has(e.prev.type)&&(t=!0)}return t}return!1});if(f>0){g.push(e.uuid);let x=i.stack.filter(e=>b.includes(e.uuid));i.stack=i.stack.filter(e=>!g.includes(e.uuid)),i.children=m(i.stack),o(),i.stack.push(...x),i.stack.push(e);let w=t.map(e=>{let t=s.cloneDeep(e);return t.prev=null,t.type===X.Paragraph&&v&&(t.cssStyle["text-indent"]="0"),t});i.stack.push(...w)}function k(e){let r=[],n=[],s=0,i=[e,...t],l={ignoredType:null,uuid:null};for(let e of i){if(l.ignoredType){let t=e.children.findIndex(e=>e.uuid===l.uuid),a=e.children.slice(0,t);a.reverse();for(let e of a){if(e.type!==l.ignoredType){s+=1;break}r.push(e.uuid),n.push(e.uuid)}}if(l.uuid=e.uuid,e.prev){if(!c.has(e.prev.type)){s+=1;break}l.ignoredType=e.prev.type}else l.ignoredType=null,e.parent.uuid!==a.uuid&&n.push(e.parent.uuid)}return{left:s,removedElementIds:n,ignoredElementIds:r}}}if(e.break==q.Page&&(i.children=m(i.stack),o()),e.type===X.SectionBreak){switch(e.break){case U.Continuous:case U.NextColumn:break;case U.EvenPage:case U.OddPage:case U.NextPage:default:i.children=m(i.stack),o()}}};let d=[];u(a,[]);let p=[];for(;d.length>0;){let[e,n]=d.pop();if(e.type===X.Paragraph){const n=null===(t=e.props)||void 0===t?void 0:t.sectionProperties;if(n){n.sectionId=O();let t={type:X.SectionBreak,break:null!==(r=n.type)&&void 0!==r?r:U.NextPage},a={type:X.Run,children:[t]};e.children.push(a)}}p.push([e,n]),u(e,n)}let h=null!==(n=a.sectProps.type)&&void 0!==n?n:U.NextPage;for(let e=p.length-1;e>=0;e--){let[t]=p[e];if(t.type===X.SectionBreak){let{break:e}=t;t.break=h,h=e}}for(let e=0;e<p.length;e++){let[t,r]=p[e];0===i.stack.length&&(t.prev=null),i.stack.push(t),c(t,r)}function u(e,t){var r,n;const a=null!==(n=null===(r=null==e?void 0:e.children)||void 0===r?void 0:r.length)&&void 0!==n?n:0;if(0===a)return;if(e.type===X.Text)return;let s=null;for(let r=a-1;r>=0;r--){const n=e.children[r];n.uuid=O(),n.parent={uuid:e.uuid,type:e.type},s&&(s.prev={uuid:n.uuid,type:n.type}),0===r&&(n.prev=null),s=n;let a=e.type===X.Document?[]:[e,...t];d.push([n,a])}}function m(e){let t=e.filter(e=>e.parent.uuid===a.uuid);const r=function(e,t){return t.map(t=>{let n=e.filter(e=>e.parent.uuid===t.uuid);return n.length?Object.assign(Object.assign({},t),{children:r(e,n)}):Object.assign({},t)})};return r(e,t)}i.stack.length>0&&(i.isSplit=!1,i.children=m([...i.stack]),i.sectProps=a.sectProps,l.push(i));let f=null;for(let e of l)e.sectProps&&((null==f?void 0:f.headerRefs)&&(e.sectProps.headerRefs=s.unionBy(e.sectProps.headerRefs,f.headerRefs,"type")),(null==f?void 0:f.footerRefs)&&(e.sectProps.footerRefs=s.unionBy(e.sectProps.footerRefs,f.footerRefs,"type")),f=e.sectProps);let g=null;for(let e=l.length-1;e>=0;e--)null==l[e].sectProps?l[e].sectProps=g:g=l[e].sectProps;return l}renderPages(e){return i(this,void 0,void 0,function*(){let t;t=this.options.breakPages?this.splitPageBySymbol(e):[new ht({isSplit:!0,sectProps:e.sectProps,children:e.children})],e.pages=t;let r=null,n=[...t];for(let t=0;t<n.length;t++){this.currentFootnoteIds=[];const a=n[t],{sectProps:s}=a;a.sectProps=null!=s?s:e.sectProps,a.isFirstPage=r!=a.sectProps,a.isLastPage=t===n.length-1,a.checkingOverflow=!1,this.currentPage=a,r=a.sectProps,yield this.renderPage()}})}renderPage(){return i(this,void 0,void 0,function*(){const{pageId:e,sectProps:t,children:r,isFirstPage:n,isLastPage:a}=this.currentPage;this.processElement(this.currentPage);const i=this.createPage(this.className,t);this.renderStyleValues(this.document.documentPart.body.cssStyle,i);let l=this.document.documentPart.body.pages,o=l.findIndex(t=>t.pageId===e),c=null,d=null;this.options.renderHeaders&&(c=yield this.renderHeaderFooterRef(t.headerRefs,t,o,n,i)),this.options.renderFooters&&(d=yield this.renderHeaderFooterRef(t.footerRefs,t,o,n,i));const p=this.createPageContent(t);let h=e=>{var t;return(null!==(t=null==e?void 0:e.offsetHeight)&&void 0!==t?t:0)*this.pointToPixelRatio},{pageSize:u,pageMargins:m}=t,f=h(c),g=h(d),b=s.max([parseFloat(m.top),f]),y=s.max([parseFloat(m.bottom),g]);i.style.paddingTop=`${b}pt`,i.style.paddingBottom=`${y}pt`,this.options.breakPages?p.style.height=parseFloat(u.height)-b-y+"pt":p.style.minHeight=parseFloat(u.height)-b-y+"pt",this.currentPage.contentElement=p,i.appendChild(p),this.currentPage.checkingOverflow=!0,(yield this.renderElements(r,p))===Nt.FALSE&&(this.currentPage.isSplit=!0,l[o]=this.currentPage),this.currentPage.checkingOverflow=!1,this.options.renderFootnotes&&(yield this.renderNotes(X.Footnotes,this.currentFootnoteIds,this.footnoteMap,i)),this.options.renderEndnotes&&a&&(yield this.renderNotes(X.Endnotes,this.currentEndnoteIds,this.endnoteMap,i))})}createPage(e,t){const r=Mt("section",{className:e});return t&&(r.dataset.sectionId=t.sectionId,t.pageMargins&&(r.style.paddingLeft=t.pageMargins.left,r.style.paddingRight=t.pageMargins.right,r.style.paddingTop=t.pageMargins.top,r.style.paddingBottom=t.pageMargins.bottom),t.pageSize&&(this.options.ignoreWidth||(r.style.width=t.pageSize.width),this.options.ignoreHeight||(r.style.minHeight=t.pageSize.height))),this.wrapper.appendChild(r),r}createPageContent(e){const t=Mt("article");if(e.columns){const{count:r,space:n,separator:a}=e.columns;r>1&&(t.style.columnCount=`${r}`,t.style.columnGap=n),a&&(t.style.columnRule="1px solid black")}return t}renderHeaderFooterRef(e,t,r,n,a){return i(this,void 0,void 0,function*(){var s,i,l,o;if(!e)return null;let c;if(c=t.titlePage&&n?e.find(e=>"first"==e.type):this.document.settingsPart.settings.evenAndOddHeaders?(r+=1)%2==0?e.find(e=>"even"===e.type):e.find(e=>"default"===e.type||"odd"===e.type):e.find(e=>"default"===e.type),!c)return console.error("Header/Footer reference is not found"),null;let d=this.document.findPartByRelId(null==c?void 0:c.id,this.document.documentPart);if(!d)return console.error(`Part corresponding to the reference with id:${null==c?void 0:c.id} is not found`),null;this.currentPart=d,!1===this.usedHeaderFooterParts.includes(d.path)&&(this.processElement(d.rootElement),this.usedHeaderFooterParts.push(d.path));let p=null;switch(d.rootElement.type){case X.Header:d.rootElement.cssStyle={left:null===(s=t.pageMargins)||void 0===s?void 0:s.left,"padding-top":t.pageMargins.header,width:null===(i=t.contentSize)||void 0===i?void 0:i.width},p=yield this.renderHeaderFooter(d.rootElement,"header",a);break;case X.Footer:d.rootElement.cssStyle={left:null===(l=t.pageMargins)||void 0===l?void 0:l.left,"padding-bottom":t.pageMargins.footer,width:null===(o=t.contentSize)||void 0===o?void 0:o.width},p=yield this.renderHeaderFooter(d.rootElement,"footer",a);break;default:console.warn("set header/footer style error",d.rootElement.type)}return this.currentPart=null,p})}renderNotes(){return i(this,arguments,void 0,function*(e=X.Footnotes,t,r,n){const a=t.map(e=>r[e]).filter(e=>e);if(a.length>0){const t=Mt("ol",null);let r=e===X.Footnotes?new Ae:new Re;r.children=a,this.processElement(r),yield this.renderChildren(r,t),n.appendChild(t)}})}renderElements(e,t){return i(this,void 0,void 0,function*(){var r,n;let a=[],s=this.document.documentPart.body.pages,{pageId:i,sectProps:l,children:o}=this.currentPage,c=s.findIndex(e=>e.pageId===i);for(let i=0;i<e.length;i++){const d=e[i];d.index=i,d.breakIndex||(d.breakIndex=new Set);const p=yield this.renderElement(d,t);let h,u=null!==(n=null===(r=null==p?void 0:p.dataset)||void 0===r?void 0:r.overflow)&&void 0!==n?n:Nt.UNKNOWN;switch(u){case Nt.SELF:d.breakIndex.add(0),d.parent.breakIndex.add(i),Dt(p,t),h="break";break;case Nt.TRUE:case Nt.FULL:d.parent.breakIndex.add(i),d.type!==X.Cell&&Dt(p,t),h="break";break;case Nt.PART:d.parent.breakIndex.add(i),h="break";break;case Nt.FALSE:case Nt.UNKNOWN:case Nt.IGNORE:h="continue";break;default:h="continue",this.options.debug&&console.error("unhandled overflow",u,d)}if(d.type===X.Cell&&(h="continue"),a.push(u),"continue"!==h){if(2===d.level){let e=o.splice(i);const t=new ht({sectProps:l,children:e});this.splitElementsByBreakIndex(this.currentPage,t),this.currentPage.isSplit=!0,this.currentPage.checkingOverflow=!1,this.processElement(this.currentPage),s[c]=this.currentPage,s.splice(c+1,0,t),this.currentPage=t,yield this.renderPage()}break}}if(0===a.length)return Nt.FALSE;let d=[Nt.FULL,Nt.SELF,Nt.TRUE,Nt.PART];return a.every(e=>e===Nt.PART)?Nt.PART:a.every(e=>d.includes(e))?Nt.FULL:a.every(e=>e===Nt.UNKNOWN)?Nt.UNKNOWN:a.every(e=>[Nt.FALSE,Nt.UNKNOWN,Nt.IGNORE].includes(e))?Nt.FALSE:a.some(e=>d.includes(e))?Nt.PART:Nt.UNKNOWN})}splitElementsByBreakIndex(e,t){for(let n=0;n<(null==t?void 0:t.children.length);n++){let a=t.children[n],{type:i,breakIndex:l,children:o}=a;if(!l)continue;if(!o||0===(null==o?void 0:o.length))continue;let c=s.cloneDeepWith(a,(e,t)=>{if("parent"===t)return null}),d=l.size>0?[...l][0]:o.length;switch(i){case X.Table:let t=[];t=o.filter(e=>e.isHeader);const s=o.splice(0,d);o[0].children.forEach(e=>{"continue"===e.verticalMerge&&(e.verticalMerge="restart")}),t.length>0&&t.length<o.length&&o.unshift(...t),c.children=s,e.children.push(c);break;case X.Row:if(null==a?void 0:a.isHeader)continue;e.children.push(c);break;case X.Cell:c.children=o.splice(0,d),e.children[n]=c;break;case X.Paragraph:let i=r(a);c.children=o.splice(0,d),e.children.push(c),i&&(a.cssStyle["text-indent"]="0");break;default:c.children=o.splice(0,d),e.children.push(c)}i!==X.Row&&l.size>0&&(a.breakIndex=void 0),o.length>0&&this.splitElementsByBreakIndex(c,a)}function r(e){let{breakIndex:t,children:n,type:a}=e;if(!t)return!1;if(!n||0===(null==n?void 0:n.length))return!1;let s=[...t][0];return 0===s?r(n[s]):s<n.length||void 0}}renderElement(e,t){return i(this,void 0,void 0,function*(){let r;switch(e.type){case X.Paragraph:r=yield this.renderParagraph(e,t);break;case X.Run:r=yield this.renderRun(e,t);break;case X.Text:r=yield this.renderText(e,t);break;case X.Character:r=yield this.renderCharacter(e,t);break;case X.Table:r=yield this.renderTable(e,t);break;case X.Row:r=yield this.renderTableRow(e,t);break;case X.Cell:r=yield this.renderTableCell(e,t);break;case X.Hyperlink:r=yield this.renderHyperlink(e,t);break;case X.Drawing:r=yield this.renderDrawing(e,t);break;case X.Image:r=yield this.renderImage(e,t);break;case X.BookmarkStart:r=this.renderBookmarkStart(e,t);break;case X.BookmarkEnd:r=null;break;case X.Tab:r=yield this.renderTab(e,t);break;case X.Symbol:r=yield this.renderSymbol(e,t);break;case X.Break:r=yield this.renderBreak(e,t);break;case X.LastRenderedPageBreak:r=yield this.renderLastRenderedPageBreak(e,t);break;case X.SectionBreak:r=yield this.renderSectionBreak(e,t);break;case X.Inserted:r=yield this.renderInserted(e,t);break;case X.Deleted:r=yield this.renderDeleted(e,t);break;case X.DeletedText:r=yield this.renderDeletedText(e,t);break;case X.NoBreakHyphen:r=Mt("wbr"),t&&(yield this.appendChildren(t,r));break;case X.CommentRangeStart:r=this.renderCommentRangeStart(e),t&&r&&t.appendChild(r);break;case X.CommentRangeEnd:r=this.renderCommentRangeEnd(e),t&&r&&t.appendChild(r);break;case X.CommentReference:r=yield this.renderCommentReference(e),t&&r&&t.appendChild(r);break;case X.Footer:r=yield this.renderHeaderFooter(e,"footer",t);break;case X.Header:r=yield this.renderHeaderFooter(e,"header",t);break;case X.Footnote:case X.Endnote:r=yield this.renderContainer(e,"li"),t&&$t(t,r);break;case X.FootnoteReference:r=this.renderFootnoteReference(e),t&&$t(t,r);break;case X.EndnoteReference:r=this.renderEndnoteReference(e),t&&$t(t,r);break;case X.VmlElement:r=yield this.renderVmlElement(e,t);break;case X.VmlPicture:r=yield this.renderVmlPicture(e),t&&$t(t,r);break;case X.MmlMath:r=yield this.renderContainerNS(e,Pt,"math",{xmlns:Pt}),t&&(r.dataset.overflow=yield this.appendChildren(t,r));break;case X.MmlMathParagraph:r=yield this.renderContainer(e,"span"),t&&$t(t,r);break;case X.MmlFraction:r=yield this.renderContainerNS(e,Pt,"mfrac"),t&&$t(t,r);break;case X.MmlBase:r=yield this.renderContainerNS(e,Pt,e.parent.type==X.MmlMatrixRow?"mtd":"mrow"),t&&$t(t,r);break;case X.MmlNumerator:case X.MmlDenominator:case X.MmlFunction:case X.MmlLimit:case X.MmlBox:r=yield this.renderContainerNS(e,Pt,"mrow"),t&&$t(t,r);break;case X.MmlGroupChar:r=yield this.renderMmlGroupChar(e),t&&$t(t,r);break;case X.MmlLimitLower:r=yield this.renderContainerNS(e,Pt,"munder"),t&&$t(t,r);break;case X.MmlMatrix:r=yield this.renderContainerNS(e,Pt,"mtable"),t&&$t(t,r);break;case X.MmlMatrixRow:r=yield this.renderContainerNS(e,Pt,"mtr"),t&&$t(t,r);break;case X.MmlRadical:r=yield this.renderMmlRadical(e),t&&$t(t,r);break;case X.MmlSuperscript:r=yield this.renderContainerNS(e,Pt,"msup"),t&&$t(t,r);break;case X.MmlSubscript:r=yield this.renderContainerNS(e,Pt,"msub"),t&&$t(t,r);break;case X.MmlDegree:case X.MmlSuperArgument:case X.MmlSubArgument:r=yield this.renderContainerNS(e,Pt,"mn"),t&&$t(t,r);break;case X.MmlFunctionName:r=yield this.renderContainerNS(e,Pt,"ms"),t&&$t(t,r);break;case X.MmlDelimiter:r=yield this.renderMmlDelimiter(e),t&&$t(t,r);break;case X.MmlRun:r=yield this.renderMmlRun(e),t&&$t(t,r);break;case X.MmlNary:r=yield this.renderMmlNary(e),t&&$t(t,r);break;case X.MmlPreSubSuper:r=yield this.renderMmlPreSubSuper(e),t&&$t(t,r);break;case X.MmlBar:r=yield this.renderMmlBar(e),t&&$t(t,r);break;case X.MmlEquationArray:r=yield this.renderMllList(e),t&&$t(t,r)}return r&&1===(null==r?void 0:r.nodeType)&&(r.dataset.tag=e.type),r})}renderChildren(e,t){return i(this,void 0,void 0,function*(){return yield this.renderElements(e.children,t)})}appendChildren(e,t){return i(this,void 0,void 0,function*(){$t(e,t);let{isSplit:r,contentElement:n,checkingOverflow:a}=this.currentPage;if(r)return Nt.UNKNOWN;if(a){return function(e){const t=getComputedStyle(e).overflow;t&&"visible"!==t||(e.style.overflow="hidden");const r=e.clientHeight<e.scrollHeight;return e.style.overflow=t,r}(n)?Nt.TRUE:Nt.FALSE}return Nt.UNKNOWN})}renderContainer(e,t,r){return i(this,void 0,void 0,function*(){const n=Mt(t,r);return n.dataset.overflow=yield this.renderChildren(e,n),n})}renderContainerNS(e,t,r,n){return i(this,void 0,void 0,function*(){const a=Et(t,r,n);return yield this.renderChildren(e,a),a})}renderParagraph(e,t){return i(this,void 0,void 0,function*(){var r,n,a;const i=Mt("p");i.dataset.uuid=e.uuid,this.renderClass(e,i),Object.assign(e.cssStyle,te(e.props,this.currentPage.sectProps)),this.renderStyleValues(e.cssStyle,i),this.renderCommonProperties(i.style,e.props);const l=this.findStyle(e.styleName);e.props.tabs=s.unionBy(e.props.tabs,null===(r=null==l?void 0:l.paragraphProps)||void 0===r?void 0:r.tabs,"position");const o=null!==(n=e.props.numbering)&&void 0!==n?n:null===(a=null==l?void 0:l.paragraphProps)||void 0===a?void 0:a.numbering;o&&i.classList.add(this.numberingClass(o.id,o.level));const c=e.children.some(e=>{var t,r;const n=null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.some(e=>e.type===X.Drawing&&e.props.wrapType===K.TopAndBottom),a=null===(r=null==e?void 0:e.children)||void 0===r?void 0:r.some(e=>{var t;return e.type===X.Break&&(null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.clear)});return n||a});let d;return c&&i.classList.add("clearfix"),i.style.position="relative",d=yield this.appendChildren(t,i),d===Nt.TRUE?(i.dataset.overflow=Nt.SELF,i):(i.dataset.overflow=yield this.renderChildren(e,i),i)})}renderRun(e,t){return i(this,void 0,void 0,function*(){if(e.fieldRun)return null;const r=Mt("span");let n;if(this.renderClass(e,r),this.renderStyleValues(e.cssStyle,r),n=yield this.appendChildren(t,r),n===Nt.TRUE)return r.dataset.overflow=Nt.SELF,r;if(e.verticalAlign){const t=Mt(e.verticalAlign);return $t(r,t),r.dataset.overflow=yield this.renderChildren(e,t),r}return r.dataset.overflow=yield this.renderChildren(e,r),r})}renderText(e,t){return i(this,void 0,void 0,function*(){let r=document.createTextNode("");r.dataset={overflow:Nt.UNKNOWN},$t(t,r);let{isSplit:n}=this.currentPage;return n?(r.appendData(e.text),r):(r.dataset.overflow=yield this.renderChildren(e,r),r)})}renderCharacter(e,t){return i(this,void 0,void 0,function*(){let r=document.createTextNode(e.char);return r.dataset={overflow:Nt.UNKNOWN},r.dataset.overflow=yield this.appendChildren(t,r),r})}renderTable(e,t){return i(this,void 0,void 0,function*(){const r=Mt("table");let n;return r.dataset.uuid=O(),this.tableCellPositions.push(this.currentCellPosition),this.tableVerticalMerges.push(this.currentVerticalMerge),this.currentVerticalMerge={},this.currentCellPosition={col:0,row:0},this.renderClass(e,r),this.renderStyleValues(e.cssStyle,r),n=yield this.appendChildren(t,r),n===Nt.TRUE?(r.dataset.overflow=Nt.SELF,r):(e.columns&&this.renderTableColumns(e.columns,r),r.dataset.overflow=yield this.renderChildren(e,r),this.currentVerticalMerge=this.tableVerticalMerges.pop(),this.currentCellPosition=this.tableCellPositions.pop(),r)})}renderTableColumns(e,t){const r=Mt("colgroup");$t(t,r);for(const t of e){const e=Mt("col");t.width&&(e.style.width=t.width),$t(r,e)}return r}renderTableRow(e,t){return i(this,void 0,void 0,function*(){const r=Mt("tr");let n;return this.currentCellPosition.col=0,this.renderClass(e,r),this.renderStyleValues(e.cssStyle,r),n=yield this.appendChildren(t,r),n===Nt.TRUE?(r.dataset.overflow=Nt.SELF,r):(r.dataset.overflow=yield this.renderChildren(e,r),this.currentCellPosition.row++,r)})}renderTableCell(e,t){return i(this,void 0,void 0,function*(){const r=Mt("td"),n=this.currentCellPosition.col;let a;return e.verticalMerge?"restart"==e.verticalMerge?(this.currentVerticalMerge[n]=r,r.rowSpan=1):this.currentVerticalMerge[n]&&(this.currentVerticalMerge[n].rowSpan+=1,r.style.display="none"):this.currentVerticalMerge[n]=null,this.renderClass(e,r),this.renderStyleValues(e.cssStyle,r),e.span&&(r.colSpan=e.span),this.currentCellPosition.col+=r.colSpan,a=yield this.appendChildren(t,r),a===Nt.TRUE?(r.dataset.overflow=Nt.SELF,r):(r.dataset.overflow=yield this.renderChildren(e,r),r)})}renderHyperlink(e,t){return i(this,void 0,void 0,function*(){const r=Mt("a");let n;if(this.renderStyleValues(e.cssStyle,r),n=yield this.appendChildren(t,r),n===Nt.TRUE)return r.dataset.overflow=Nt.SELF,r;if(e.href)r.href=e.href;else if(e.id){const t=this.document.documentPart.rels.find(t=>t.id==e.id&&"External"===t.targetMode);r.href=null==t?void 0:t.target}return r.dataset.overflow=yield this.renderChildren(e,r),r})}renderDrawing(e,t){return i(this,void 0,void 0,function*(){const r=Mt("span");let n;return r.style.display="inline-block",r.style.position="relative",r.style.textIndent="0px",r.dataset.wrap=null==e?void 0:e.props.wrapType,this.renderStyleValues(e.cssStyle,r),n=yield this.appendChildren(t,r),n===Nt.TRUE?(r.dataset.overflow=Nt.SELF,r):(r.dataset.overflow=yield this.renderChildren(e,r),r)})}renderImage(e,t){return i(this,void 0,void 0,function*(){const{is_clip:r,is_transform:n}=e.props,a=new Image;this.renderStyleValues(e.cssStyle,a);const s=yield this.document.loadDocumentImage(e.src,this.currentPart);if(r||n)try{a.src=yield this.transformImage(e,s)}catch(t){console.error(`transform ${e.src} image error:`,t)}else a.src=s;return a.dataset.overflow=yield this.appendChildren(t,a),a})}renderKonva(){const e=Mt("div");e.id="konva-container",$t(this.bodyContainer,e),this.konva_stage=new n.Stage({container:"konva-container"}),this.konva_layer=new n.Layer({listening:!1}),this.konva_stage.add(this.konva_layer),this.konva_stage.visible(!0)}transformImage(e,t){return i(this,void 0,void 0,function*(){const{is_clip:r,clip:a,is_transform:s,transform:i}=e.props,l=new Image;l.src=t,yield l.decode();const{naturalWidth:o,naturalHeight:c}=l;this.konva_stage.width(o),this.konva_stage.height(c),this.konva_layer.removeChildren();const d=new n.Group,p=new n.Image({image:l,x:o/2,y:c/2,width:o,height:c,offset:{x:o/2,y:c/2}});if(r){const{left:e,right:t,top:r,bottom:n}=a.path,s=o*e,i=c*r,l=o*(1-e-t),d=c*(1-r-n);p.crop({x:s,y:i,width:l,height:d}),p.size({width:l,height:d})}if(s)for(const e in i)switch(e){case"scaleX":p.scaleX(i[e]);break;case"scaleY":p.scaleY(i[e]);break;case"rotate":p.rotation(i[e])}let h;if(d.add(p),this.konva_layer.add(d),this.options.useBase64URL)h=d.toDataURL();else{const e=yield d.toBlob();h=URL.createObjectURL(e)}return h})}renderBookmarkStart(e,t){const r=Mt("span");return r.id=e.name,$t(t,r),r.dataset.overflow=Nt.IGNORE,r}renderTab(e,t){return i(this,void 0,void 0,function*(){var r;const n=Mt("span");if(n.innerHTML="&nbsp;",this.options.experimental){n.className=this.tabStopClass();const t=null===(r=function(e,t){let r=e.parent;for(;null!=r&&r.type!=t;)r=r.parent;return r}(e,X.Paragraph).props)||void 0===r?void 0:r.tabs;this.currentTabs.push({stops:t,span:n})}return t&&(yield this.appendChildren(t,n)),n})}renderSymbol(e,t){return i(this,void 0,void 0,function*(){const r=Mt("span");let n;return r.style.fontFamily=e.font,r.innerHTML=`&#x${e.char};`,n=yield this.appendChildren(t,r),n===Nt.TRUE&&(r.dataset.overflow=Nt.SELF),r.dataset.overflow=n,r})}renderBreak(e,t){return i(this,void 0,void 0,function*(){let r;switch(e.break){case q.Page:r=Mt("br"),r.classList.add("break","page");break;case q.Column:r=Mt("br"),r.classList.add("break","column");break;case q.TextWrapping:default:r=Mt("br"),r.classList.add("break","textWrap")}let n=yield this.appendChildren(t,r);return n===Nt.TRUE&&(n=Nt.SELF),r.dataset.overflow=n,r})}renderLastRenderedPageBreak(e,t){return i(this,void 0,void 0,function*(){const e=Mt("wbr");e.classList.add("lastRenderedPageBreak");let r=yield this.appendChildren(t,e);return r===Nt.TRUE&&(r=Nt.SELF),e.dataset.overflow=r,e})}renderSectionBreak(e,t){return i(this,void 0,void 0,function*(){const r=Mt("s");r.classList.add("break","section");let n=yield this.appendChildren(t,r);return n===Nt.TRUE&&(n=Nt.SELF),r.dataset.overflow=n,r.dataset.type=e.break,r})}renderInserted(e,t){return i(this,void 0,void 0,function*(){const r=Mt(this.options.renderChanges?"ins":"span");let n;return n=yield this.appendChildren(t,r),n===Nt.TRUE?(r.dataset.overflow=Nt.SELF,r):(r.dataset.overflow=yield this.renderChildren(e,r),r)})}renderDeleted(e,t){return i(this,void 0,void 0,function*(){let r,n=Mt("del");return!1===this.options.renderChanges&&(n.style.display="none"),r=yield this.appendChildren(t,n),r===Nt.TRUE?(n.dataset.overflow=Nt.SELF,n):(n.dataset.overflow=yield this.renderChildren(e,n),n)})}renderDeletedText(e,t){return i(this,void 0,void 0,function*(){return this.options.renderChanges,this.renderText(e,t)})}renderCommentRangeStart(e){var t;if(!this.options.renderComments)return null;const r=new Range;null===(t=this.commentHighlight)||void 0===t||t.add(r);const n=document.createComment(`start of comment #${e.id}`);return this.later(()=>r.setStart(n,0)),this.commentMap[e.id]=r,n}renderCommentRangeEnd(e){if(!this.options.renderComments)return null;const t=this.commentMap[e.id],r=document.createComment(`end of comment #${e.id}`);return this.later(()=>null==t?void 0:t.setEnd(r,0)),r}renderCommentReference(e){return i(this,void 0,void 0,function*(){var t;if(!this.options.renderComments)return null;var r=null===(t=this.document.commentsPart)||void 0===t?void 0:t.commentMap[e.id];if(!r)return null;const n=new DocumentFragment,a=Mt("span",{className:`${this.className}-comment-ref`});a.textContent="💬";const s=Mt("div",{className:`${this.className}-comment-popover`});return yield this.renderCommentContent(r,s),n.appendChild(document.createComment(`comment #${r.id} by ${r.author} on ${r.date}`)),n.appendChild(a),n.appendChild(s),n})}renderCommentContent(e,t){return i(this,void 0,void 0,function*(){const r=Mt("div",{className:`${this.className}-comment-author`});r.textContent=e.author,t.appendChild(r);const n=Mt("div",{className:`${this.className}-comment-date`});n.textContent=new Date(e.date).toLocaleString(),t.appendChild(n),yield this.renderElements(e.children,t)})}renderHeaderFooter(e,t,r){return i(this,void 0,void 0,function*(){const n=Mt(t);return $t(r,n),this.renderStyleValues(e.cssStyle,n),yield this.renderChildren(e,n),n})}renderFootnoteReference(e){const t=Mt("sup");return this.currentFootnoteIds.push(e.id),t.textContent=`${this.currentFootnoteIds.length}`,t}renderEndnoteReference(e){const t=Mt("sup");return this.currentEndnoteIds.push(e.id),t.textContent=`${this.currentEndnoteIds.length}`,t}renderVmlElement(e,t){return i(this,void 0,void 0,function*(){var r,n;const a=At("svg");a.setAttribute("style",e.cssStyleText);const s=yield this.renderVmlChildElement(e);if(null===(r=e.imageHref)||void 0===r?void 0:r.id){const t=yield null===(n=this.document)||void 0===n?void 0:n.loadDocumentImage(e.imageHref.id,this.currentPart);s.setAttribute("href",t)}return $t(a,s),requestAnimationFrame(()=>{const e=a.firstElementChild.getBBox();a.setAttribute("width",`${Math.ceil(e.x+e.width)}`),a.setAttribute("height",`${Math.ceil(e.y+e.height)}`)}),t&&(a.dataset.overflow=yield this.appendChildren(t,a)),a})}renderVmlPicture(e){return i(this,void 0,void 0,function*(){const t=Mt("span");return yield this.renderChildren(e,t),t})}renderVmlChildElement(e){return i(this,void 0,void 0,function*(){const t=At(e.tagName);Object.entries(e.attrs).forEach(([e,r])=>t.setAttribute(e,r));for(const r of e.children)if(r.type==X.VmlElement){const e=yield this.renderVmlChildElement(r);$t(t,e)}else yield this.renderElement(r,t);return t})}renderMmlRadical(e){return i(this,void 0,void 0,function*(){var t;const r=e.children.find(e=>e.type==X.MmlBase);let n;if(null===(t=e.props)||void 0===t?void 0:t.hideDegree)return n=Et(Pt,"msqrt",null),yield this.renderElements([r],n),n;const a=e.children.find(e=>e.type==X.MmlDegree);return n=Et(Pt,"mroot",null),yield this.renderElements([r,a],n),n})}renderMmlDelimiter(e){return i(this,void 0,void 0,function*(){var t,r;const n=Et(Pt,"mrow",null);return $t(n,Et(Pt,"mo",null,[null!==(t=e.props.beginChar)&&void 0!==t?t:"("])),yield this.renderElements(e.children,n),$t(n,Et(Pt,"mo",null,[null!==(r=e.props.endChar)&&void 0!==r?r:")"])),n})}renderMmlNary(e){return i(this,void 0,void 0,function*(){var t,r;const n=[],a=s.keyBy(e.children,"type"),i=a[X.MmlSuperArgument],l=a[X.MmlSubArgument];let o=i?Et(Pt,"mo",null,L(yield this.renderElement(i))):null,c=l?Et(Pt,"mo",null,L(yield this.renderElement(l))):null,d=Et(Pt,"mo",null,[null!==(r=null===(t=e.props)||void 0===t?void 0:t.char)&&void 0!==r?r:"∫"]);o||c?n.push(Et(Pt,"munderover",null,[d,c,o])):o?n.push(Et(Pt,"mover",null,[d,o])):c?n.push(Et(Pt,"munder",null,[d,c])):n.push(d);const p=Et(Pt,"mrow",null);return $t(p,n),yield this.renderElements(a[X.MmlBase].children,p),p})}renderMmlPreSubSuper(e){return i(this,void 0,void 0,function*(){const t=[],r=s.keyBy(e.children,"type"),n=r[X.MmlSuperArgument],a=r[X.MmlSubArgument];let i=n?Et(Pt,"mo",null,L(yield this.renderElement(n))):null,l=a?Et(Pt,"mo",null,L(yield this.renderElement(a))):null,o=Et(Pt,"mo",null);t.push(Et(Pt,"msubsup",null,[o,l,i]));const c=Et(Pt,"mrow",null);return $t(c,t),yield this.renderElements(r[X.MmlBase].children,c),c})}renderMmlGroupChar(e){return i(this,void 0,void 0,function*(){let t="bot"===e.props.verticalJustification?"mover":"munder",r=yield this.renderContainerNS(e,Pt,t);if(e.props.char){$t(r,Et(Pt,"mo",null,[e.props.char]))}return r})}renderMmlBar(e){return i(this,void 0,void 0,function*(){let t=yield this.renderContainerNS(e,Pt,"mrow");switch(e.props.position){case"top":t.style.textDecoration="overline";break;case"bottom":t.style.textDecoration="underline"}return t})}renderMmlRun(e){return i(this,void 0,void 0,function*(){const t=Et(Pt,"ms");return this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),yield this.renderChildren(e,t),t})}renderMllList(e){return i(this,void 0,void 0,function*(){const t=Et(Pt,"mtable");this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t);for(const r of e.children){const e=yield this.renderElement(r),n=Et(Pt,"mtd",null,[e]);$t(t,Et(Pt,"mtr",null,[n]))}return t})}renderStyleValues(e,t){for(const r in e)r.startsWith("$")?t.setAttribute(r.slice(1),e[r]):t.style[r]=e[r]}renderRunProperties(e,t){this.renderCommonProperties(e,t)}renderCommonProperties(e,t){null!=t&&(t.color&&(e.color=t.color),t.fontSize&&(e["font-size"]=t.fontSize))}renderClass(e,t){e.className&&(t.className=e.className),e.styleName&&t.classList.add(this.processStyleName(e.styleName))}findStyle(e){var t;return e&&(null===(t=this.styleMap)||void 0===t?void 0:t[e])}tabStopClass(){return`${this.className}-tab-stop`}refreshTabStops(){if(this.options.experimental)for(const e of this.currentTabs)pt(e.span,e.stops,this.defaultTabSize,this.pointToPixelRatio)}}function Mt(e,t){return Et(null,e,t)}function At(e,t){return Et(Ct,e,t)}function Et(e,t,r,n){let a;switch(e){case"http://www.w3.org/1998/Math/MathML":case"http://www.w3.org/2000/svg":a=document.createElementNS(e,t);break;default:a=document.createElement(t)}return r&&Object.assign(a,r),n&&$t(a,n),a}function Rt(e){e.innerHTML=""}function $t(e,t){if(e instanceof Element&&(Array.isArray(t)?e.append(...t):s.isString(t)?e.append(t):e.appendChild(t)),e instanceof Text){if(Array.isArray(t))throw new Error("Text append children: children must be text node");t instanceof Text&&e.appendData(t.wholeText)}}function Dt(e,t){if(void 0!==t){if(t instanceof Text){if(Array.isArray(e))throw new Error("Text remove target: target must be text node!");e instanceof Text&&t.deleteData(t.length-e.length,e.length)}t instanceof Element&&(Array.isArray(e)?e.forEach(e=>{e instanceof Element?e.remove():t.removeChild(e)}):e instanceof Element?e.remove():t.removeChild(e))}else if(Array.isArray(e))e.forEach(e=>{if(!(e instanceof Element))throw new Error("removeElements: target must be Element!");e.remove()});else{if(!(e instanceof Element))throw new Error("removeElements: target must be Element!");e.remove()}}function Ft(e){return Mt("style",{innerHTML:e})}function Bt(e,t){e.appendChild(document.createComment(t))}const jt={breakPages:!0,className:"docx",ignoreFonts:!1,ignoreHeight:!1,ignoreImageWrap:!1,ignoreLastRenderedPageBreak:!0,ignoreTableWrap:!0,ignoreWidth:!1,inWrapper:!0,hideWrapperOnPrint:!1,renderAltChunks:!0,renderChanges:!1,renderComments:!1,renderEndnotes:!0,renderFooters:!0,renderFootnotes:!0,renderHeaders:!0,trimXmlDeclaration:!0,useBase64URL:!1,debug:!1,experimental:!1};function Lt(e,t=null){const r=Object.assign(Object.assign({},jt),t);return _e.load(e,new st(r),r)}function Ot(e,t,r){return i(this,arguments,void 0,function*(e,t,r,n=!0,a){const s=Object.assign(Object.assign({},jt),a),i=n?new Tt:new gt;yield i.render(e,t,r,s)})}e.defaultOptions=jt,e.parseAsync=Lt,e.renderAsync=function(e,t,r,n){return i(this,void 0,void 0,function*(){const a=yield Lt(e,n);return yield Ot(a,t,r,!1,n),a})},e.renderDocument=Ot,e.renderSync=function(e,t){return i(this,arguments,void 0,function*(e,t,r=null,n=null){const a=yield Lt(e,n);return yield Ot(a,t,r,!0,n),a})}});
//# sourceMappingURL=docx-preview.min.js.map
